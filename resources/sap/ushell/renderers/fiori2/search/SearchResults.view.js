//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchResultListItem");jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchLayout");jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchResultListItemDetail");jQuery.sap.require("sap.ushell.ui.launchpad.SearchResultApps");jQuery.sap.require("sap.ushell.ui.launchpad.SearchResultAppItem");sap.ui.core.Control.extend("sap.search.DivLayout",{metadata:{aggregations:{content:{singularName:"content",multiple:true}}},renderer:function(r,c){var C=c.getContent();for(var i=0;i<C.length;i++){r.renderControl(C[i])}}});sap.ui.core.Control.extend("sap.search.DivContainer",{metadata:{properties:{"cssClass":"string"},aggregations:{"content":{singularName:"content",multiple:true}},},renderer:function(r,c){r.write('<div');r.writeControlData(c);r.addClass(c.getCssClass());r.writeClasses();r.write('>');var C=c.getContent();for(var i=0;i<C.length;i++){r.renderControl(C[i])}r.write('</div>')}});sap.ui.jsview("sap.ushell.renderers.fiori2.search.SearchResults",{createContent:function(c){var s=this;s.oController=c;var l={growing:true,threshold:2,inset:false,showUnread:true,width:"auto",showNoData:false};s.resultList=new sap.m.List(l);s.resultList.setGrowingThreshold(2000);s.resultList.bindAggregation("items","/results",function(p,d){return s.assembleListItem(d)});s.appSearchResult=s.assembleAppSearch();s.resultListWithDetail=new SearchResultListWithDetail({resultList:s.resultList,preview:s.assembleDetail()});s.searchLayout=new SearchLayout({showMainHeader:true,topHeader:'{i18n>apps}',topList:s.appSearchResult,bottomHeader:sap.ushell.resources.i18n.getText("others"),bottomHeaderIsUnspecific:true,bottomList:s.resultListWithDetail,});s.searchContainer=new sap.search.DivContainer({content:s.searchLayout,cssClass:'searchContainer'});return s.searchContainer},isPhone:function(){return jQuery.device.is.phone},newSearchTriggered:function(){var s=this;var S=this.getModel();S.setProperty("/count","...");S.setProperty("/resultListHeading",sap.ushell.resources.i18n.getText("searching"));s.searchContainer.setBusy(true);this.selectedPath=null},searchFinished:function(r){var s=this;var S=this.getModel();if(r.append){return}s.searchContainer.setBusy(false);s.searchLayout.setBottomCount(Math.max(r.resultset.getSearchResultSet().totalcount,0));var c=s.oController.getCategory();var b;if(c){b=c.label}else{b=sap.ushell.resources.i18n.getText("others")}if(!c||c.objectName.value==='$$ALL$$'){s.searchLayout.setBottomHeaderIsUnspecific(true);s.searchLayout.setBottomHeader(sap.ushell.resources.i18n.getText("others"))}else{s.searchLayout.setBottomHeaderIsUnspecific(false);s.searchLayout.setBottomHeader(b)}var i=s.resultList.getItems();if(r.resultset.getSearchResultSet().totalcount!==0){s.searchLayout.setBottomList(s.resultListWithDetail);var p='/results/0';s.selectItem(i[0],this.getModel().getProperty(p),p)}else{s.searchLayout.setBottomList(undefined)}},appSearchFinished:function(r){var s=this;var a=s.getController().gimmeSearchTerm();if(r.totalResults===0){s.appsFound=false;s.searchLayout.setTopCount(r.totalResults);s.searchLayout.setTopList(undefined)}else{s.appsFound=true;s.searchLayout.setTopCount(r.totalResults);s.searchLayout.setTopList(s.appSearchResult)}},onResultItemsChanged:function(){var s=this;s.resultList.setBusy(false)},startLoading:function(){},finishLoading:function(){},assembleAppSearch:function(){var s=this;var t=new sap.ushell.ui.launchpad.SearchResultApps({showNoData:false,growing:true,growingThreshold:2,growingTriggerText:{path:"i18n>showMore"},results:{path:"/tiles",template:new sap.ushell.ui.launchpad.SearchResultAppItem({icon:"{icon}",title:"{title}",targetUrl:"{url}"})}});var a=new sap.search.DivContainer({content:[t],cssClass:'appSearchResults'});return a},assembleTitleItem:function(d){var i=new sap.m.CustomListItem();var t=new sap.m.Label({text:"{title}"});t.addStyleClass('bucketTitle');i.addStyleClass('bucketTitleContainer');i.addContent(new sap.m.HBox({items:[t]}));return i},assembleFooterItem:function(d){var s=this;var i=new SearchResultListItemFooter({text:"{i18n>showMore}",showMore:function(){s.getController().gimmeSomeMore()}});return i},assembleResultListItem:function(d,p){var s=this;var i=new SearchResultListItem({title:"{$$Name$$}",titleUrl:"{uri}",type:"{dataSourceName}",imageUrl:"{imageUrl}",data:d,visibleAttributes:3,navigate:function(){},previewOpen:function(){s.selectItem(i,d,p)},previewClose:function(){}});if(s.selectedPath===p){s.selectItem(i,d,p)}return i},selectItem:function(i,d,p){var s=this;if(i===s.selectedItem){return}s.selectedPath=p;s.resultListWithDetail.setPreview(s.assembleDetail(d));if(i){i.setStatus("open")}if(s.selectedItem){s.selectedItem.setStatus("closed")}s.selectedItem=i},showApps:function(){},assembleDetail:function(d){var s=this;var a=new SearchResultListItemDetail({headerLabel:"{i18n>more_information_on}",itemTitle:d?d.$$Name$$:undefined,itemTitleUrl:d?d.uri:undefined,itemType:d?d.dataSourceName:undefined,itemData:d,firstDetailAttribute:4,maxDetailAttributes:11});return a},assembleListItem:function(d){var s=this;var D=d.getObject();if(D.type==='title'){return s.assembleTitleItem(D)}else if(D.type==='footer'){return s.assembleFooterItem(D)}else{return s.assembleResultListItem(D,d.getPath())}},getControllerName:function(){return"sap.ushell.renderers.fiori2.search.SearchResults"}})}());
