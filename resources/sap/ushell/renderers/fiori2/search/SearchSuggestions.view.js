//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.ui.launchpad.SearchSuggestionList");jQuery.sap.require("sap.ushell.ui.launchpad.SearchSuggestionListItem");sap.ui.jsview("sap.ushell.renderers.fiori2.search.SearchSuggestions",{createContent:function(c){var s=this,g=function(n){return new sap.m.GroupHeaderListItem({title:n.key,visible:n.key==="{i18n>suggestion_found_apps}"}).addStyleClass("sapMListHdr")},S=new sap.ui.model.Sorter("type",true,function(b){var k=b.getProperty("type");return k==="app"?"{i18n>suggestion_found_apps}":"{i18n>suggestions}"}),C=new sap.ui.model.Sorter("data/valueRaw",true),l=function(b,d,f,F){return F?f:b+(d?" ("+d+")":"")},o=new sap.m.Link({text:{parts:["suggestions>label","suggestions>data/valueRaw"],formatter:l},press:c.onClickSuggestion}),L=new sap.ushell.ui.launchpad.SearchSuggestionListItem({text:{parts:["suggestions>label","suggestions>valueRaw","i18n>suggestionFooter","suggestions>isGroupFooter"],formatter:l},icon:"{suggestions>icon}",isGroupFooter:"{suggestions>isGroupFooter}",type:sap.m.ListType.Active,press:c.onClickSuggestion,categories:{path:"suggestions>categories",template:o,sorter:C}}),a=new sap.ushell.ui.launchpad.SearchSuggestionList({pressUpFirstItem:this.focusSearchfield,pressEsc:this.focusSearchfield,visible:{parts:["suggestions>/visible","suggestions>/items/0/visible","suggestions>/suggestionsVisible"],formatter:function(G,A,b){if(G&&(A||b)){s.showSuggestions()}else{s.hideSuggestions()}return true}},items:{path:"suggestions>/items",sorter:S,groupHeaderFactory:g,filters:[new sap.ui.model.Filter("visible",sap.ui.model.FilterOperator.EQ,true)],template:L}});sap.ui.getCore().byId("sfOverlay").addEventDelegate({onsapdown:function(e){if(a.getItems().length>0){a.setDisableKeyboardNavigation(false);a.focus();e.preventDefault();e.stopPropagation()}},onsapescape:function(e){c.closeSuggestions();e.preventDefault();e.stopPropagation()}});return a},focusSearchfield:function(e){sap.ui.getCore().byId("sfOverlay").focus()},onAfterRendering:function(){if(!this.getModel("suggestions").getProperty("/visible")){this.hideSuggestions()}},hideSuggestions:function(){this.$().slideUp(200)},showSuggestions:function(){this.$().slideDown(200);if(this.getParent()&&this.getParent().scrollTo){this.getParent().scrollTo(0)}else{this.$().parent().scrollTop(0)}},getControllerName:function(){return"sap.ushell.renderers.fiori2.search.SearchSuggestions"}})}());
