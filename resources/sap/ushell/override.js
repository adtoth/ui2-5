// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.override");sap.ushell.override={};sap.ushell.override.updateAggregation=function(n){if(this.isTreeBinding(n)){sap.ui.base.ManagedObject.prototype.updateAggregation.apply(this,arguments)}else{var b=this.mBindingInfos[n],B=b.binding,f=b.factory,a=this.getMetadata().getJSONKeys()[n],N=null,g=null,G=null,s=null,l=0,L=0,i=[],t=[],c=this;g=a._sMutator+"Group";G=B.isGrouped()&&this[g];if(G){sap.ui.base.ManagedObject.prototype.updateAggregation.apply(this,arguments)}else{i=this[a._sGetter]();jQuery.each(B.getContexts(),function(I,C){if(l<i.length){i[l].setBindingContext(C,b.model)}else{var d=c.getId()+"-"+I,o=f(d,C).setBindingContext(C,b.model);c[a._sMutator](o)}L=l=l+1});for(l=i.length-1;l>=L;l=l-1){t.push(c[a._sRemoveMutator](i[l]))}if(t.length>0){jQuery.each(t,function(){this.destroy()})}}}};sap.ushell.override.updateAggregationGrouped=function(n){var b=this.mBindingInfos[n],B=b.binding,f=b.factory,a=this.getMetadata().getJSONKeys()[n],c,N=null,g=null,G=null,t=this,I=t.getItems(),l=0,L=0,i,s,T=[];g=B.isGrouped()&&this.addItemGroup;jQuery.each(B.getContexts(),function(d,C){if(g&&B.aSorters.length>0){N=B.aSorters[0].fnGroup(C);if(typeof N==="string"){N={key:N}}if(N.key!==G){var o,h;if(b.groupHeaderFactory){o=b.groupHeaderFactory(N)}h=o||new sap.m.GroupHeaderListItem({title:N.text||N.key}).addStyleClass("sapMListHdr");t.insertAggregation("items",h,L,true);L=L+1;G=N.key}}I=t.getItems();for(i=L;i<I.length;i=i+1){if(I[i].constructor===sap.m.GroupHeaderListItem){T.push(t.removeItem(I[i]));I=t.getItems()}}if(L<I.length){I[L].setBindingContext(C,b.model);if(I[L].aDelegates){jQuery.each(I[L].aDelegates,function(i,v){v.vThis=C})}}else{s=t.getId()+"-"+L;c=f(s,C);c.setBindingContext(C,b.model);t.addItem(c)}L=L+1;l=L});for(i=I.length-1;i>=l;i=i-1){T.push(t.removeItem(I[i]))}setTimeout(function(){jQuery.each(T,function(i,v){v.destroy()})},1)};sap.ushell.override.updateAggregatesFactory=function(n){return function(){var g="get"+n.substr(0,1).toUpperCase()+n.substr(1),b=this.mBindingInfos[n],B=b.binding.getContexts(),f=b.factory,a=this.getMetadata().getJSONKeys()[n],I=this[g](),t=this,i=0,c=function(d,C){var s=t.getId()+"-"+d,o=f(s,C);o.setBindingContext(C,b.model);t[a._sMutator](o)};for(i=0;i<B.length;++i){if(i<I.length){I[i].setBindingContext(B[i],b.model)}else{c(i,B[i])}}for(;i<I.length;++i){I[i].destroy()}I.length=B.length}}}());
