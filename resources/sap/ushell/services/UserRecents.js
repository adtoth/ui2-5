// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.services.UserRecents");jQuery.sap.require("sap.ushell.services.Personalization");function R(m,e,c,l,s){var r=[],u=function(I,t){return r.some(function(o){var f;if(e(o.oItem,I)){o.oItem=I;o.iTimestamp=t;o.iCount=o.iCount+1;f=true}else{f=false}return f})},i=function(I,t){var n={oItem:I,iTimestamp:t,iCount:1};if(r.length===m){r.sort(c);r.pop()}r.push(n)};this.newItem=function(I){var t=+new Date(),a;l().done(function(L){r=L||[];a=u(I,t);if(!a){i(I,t)}s(r)})};this.getRecentItems=function(){var d=new jQuery.Deferred();l().done(function(L){r=L||[];d.resolve(jQuery.map(r.sort(c),function(o){return o.oItem}))});return d.promise()}}function U(){var r,o,p,a,s,l,S,b="RecentApps",c="RecentSearches",P="sap.ushell.services.UserRecents";this.noticeSearch=function(d){r.newItem(d);return r.getRecentItems()};this.getRecentSearches=function(){return r.getRecentItems()};this.noticeApp=function(A){o.newItem(A);return o.getRecentItems()};this.getRecentApps=function(){return o.getRecentItems()};p=sap.ushell.Container.getService("Personalization");try{a=p.getPersonalizer({container:P,item:b});s=p.getPersonalizer({container:P,item:c})}catch(e){jQuery.sap.log.error("Personalization service does not work:");jQuery.sap.log.error(e.name+": "+e.message)}l=function(d){var f,D;try{f=d.getPersData()}catch(e){jQuery.sap.log.error("Personalization service does not work:");jQuery.sap.log.error(e.name+": "+e.message);D=new jQuery.Deferred();D.reject(e);f=D.promise()}return f};S=function(d,L){try{d.setPersData(L)}catch(e){jQuery.sap.log.error("Personalization service does not work:");jQuery.sap.log.error(e.name+": "+e.message)}};r=new R(10,function(x,y){var d=false;if(x.oDataSource&&y.oDataSource){if(x.oDataSource.objectName&&y.oDataSource.objectName){d=((x.sTerm===y.sTerm)&&(x.oDataSource.objectName.value===y.oDataSource.objectName.value))}if(!x.oDataSource.objectName&&!y.oDataSource.objectName){d=(x.sTerm===y.sTerm)}}if(!x.oDataSource&&!y.oDataSource){d=(x.sTerm===y.sTerm)}return d},function(x,y){return y.iTimestamp-x.iTimestamp},l.bind(this,s),S.bind(this,s));o=new R(4,function(x,y){return x.semanticObject===y.semanticObject&&x.action===y.action},function(x,y){return y.iTimestamp-x.iTimestamp},l.bind(this,a),S.bind(this,a))}sap.ushell.services.UserRecents=new U()}());
