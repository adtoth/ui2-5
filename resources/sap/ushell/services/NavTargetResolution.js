// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.services.NavTargetResolution");sap.ushell.services.NavTargetResolution=function(a,c){this.mCustomResolvers=[];this.resolveHashFragment=function(h){var i,r;for(i=0;i<this.mCustomResolvers.length;i=i+1){r=this.mCustomResolvers[i];if(r.isApplicable(h)){jQuery.sap.log.info("NavTargetResolution: custom resolver "+r.name+" resolves "+h);return r.resolveHashFragment(h)}}return a.resolveHashFragment(h)};this.baseResolveHashFragment=function(h){return a.resolveHashFragment(h)};this.registerCustomResolver=function(o){if(typeof o.name!=="string"){jQuery.sap.log.info("NavTargetResolution: Custom Resolver must have name {string} member")}if(typeof o.isApplicable!=="function"){jQuery.sap.log.info("NavTargetResolution: Custom Resolver must have isApplicable member")}if(typeof o.resolveHashFragment!=="function"){jQuery.sap.log.info("NavTargetResolution: Custom Resolver must have \"resolveHashFragment\" member")}this.mCustomResolvers.push(o)};this.registerCustomResolver({name:"MyFixedResolver",cleanHash:function(h){if(h===""){return undefined}var r=sap.ushell.Container.getService("URLParsing").parseShellHash(h.substring(1));if(!r){return undefined}h="#"+r.semanticObject+"-"+r.action;return h},isApplicable:function(h){h=this.cleanHash(h);if(!h){return false}return h==="#Test-test"||h==="#Test-test2"||h==="#Test-local1"||h==="#Test-local2"||h==="#Test-config"||h==="#Test-clear"},resolveHashFragment:function(h){var d=new jQuery.Deferred(),b=null,r,l,e,p,u;h=this.cleanHash(h);if(!h){return false}b={"#Test-config":{applicationType:"URL",url:"/sap/bc/ui5_ui5/ui2/ushell/test-resources/sap/ushell/demoapps/FioriSandboxConfigApp",additionalInformation:"SAPUI5.Component=sap.ushell.demoapps.FioriSandboxConfigApp"},"#Test-test":{applicationType:"URL",url:"/sap/bc/ui5_ui5/ui2/ushell/test-resources/sap/ushell/demoapps/AppNavSample?AA=BBB",additionalInformation:"SAPUI5.Component=AppNavSample"},"#Test-test2 ":{applicationType:"URL",url:"/sap/bc/ui5_ui5/ui2/ushell/test-resources/sap/ushell/demoapps/FioriSandboxDefaultApp",additionalInformation:"SAPUI5.Component=sap.ushell.demoapps.FioriSandboxDefaultApp"}};function g(k){if(localStorage){return localStorage[k]}return undefined}function f(k){return jQuery.sap.getUriParameters().get(k)}function i(k,v){if(localStorage){localStorage[k]=v}}if(b[h]){r=b[h]}else if(h==="#Test-clean"){i("sap.ushell.#Test-local1",undefined);i("sap.ushell.#Test-local2",undefined);jQuery.sap.log.info("NavTargetResolution: Local storage keys for #Test have been cleared");r=b["#Test-config"]}else if(h==="#Test-local1"||h==="#Test-local2"){r=g("sap.ushell."+h);if(!r){l={applicationType:"URL"}}else{l=JSON.parse(r)}if(window.location.hostname==="localhost"){p="sap-ushell-test-"+h.substring(6);e=f(p+"-additionalInformation");if(e){l.additionalInformation=e}u=f(p+"-url");if(u){l.url=u}}if(!l.url){jQuery.sap.log.info("NavTargetResolution: No configured app for "+h+" found ( local storage or url params sap-ushell-test-local1-url  sap-ushell-test-local1-additionalInfo  not supplied? ");jQuery.sap.log.info("NavTargetResolution: Defaulting to config app ...\n");d.resolve(b["#Test-config"])}r=l}jQuery.sap.log.info("NavTargetResolution: As URL:  http://localhost:8080/sap/bc/ui5_ui5/ui2/ushell/shells/abap/FioriLaunchpad.html?sap-ushell-test-local1-url="+encodeURIComponent(r.url)+"&sap-ushell-test-local1-additionalInformation="+encodeURIComponent(r.additionalInfo)+"#Test-local1");jQuery.sap.log.info("NavTargetResolution: Resolving "+h+" to "+JSON.stringify(r));d.resolve(r);return d.promise()}})}}());
