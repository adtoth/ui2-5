// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.services.Search");sap.ushell.services.Search=function(a,c){var C,l=sap.ushell.Container.getService("LaunchPage");this.init=function(){};this.isSearchAvailable=function(){return a.isSearchAvailable()};var _=function(){var d=jQuery.Deferred();if(C){d.resolve(C)}else{C=[];l.getCatalogs().done(function(b){var D=[];for(var i=0;i<b.length;i++){D.push(l.getCatalogTiles(b[i]))}jQuery.when.apply(jQuery,D).done(function(){var t=arguments;for(var i=0;i<t.length;i++){var T=t[i];for(var j=0;j<T.length;j++){var o=T[j],e=l.getCatalogTileView(o),k=l.getCatalogTileKeywords(o),s=l.getCatalogTileTargetURL(o),f=l.getCatalogTilePreviewTitle(o)||l.getCatalogTileTitle(o),S=l.getCatalogTileSize(o),I=l.getCatalogTilePreviewIcon(o)||"sap-icon://business-objects-experience";C.push({tile:o,keywords:k,url:s,title:f,icon:I,size:S});e.destroy()}}d.resolve(C)})})}return d.promise()};this.queryApplicationsByTarget=function(s,r){_().done(function(C){var R=[];for(var j=0,L=s&&s.length||0;j<L;j++){var S=s[j],u=sap.ushell.Container.getService("URLParsing");for(var i=0;i<C.length;i++){var t=u.parseShellHash(C[i].url);if(t&&(t.semanticObject===S.semanticObject)&&(t.action===S.action)){R.push(C[i]);break}}}r(R)})};this.queryApplications=function(s,r,t){var o=s,m=function(f,d){return{totalResults:d,searchTerm:o,getElements:function(){return f}}};s=new RegExp(s.replace("*",".*"),"gi");t=t||1;var b=function(C){var f=[],T,d,e,I,k,K,L,F;var g=0;for(var j=0;j<C.length;j++){T=C[j];e=T.title;I=T.icon;k=T.keywords;F=false;for(var i=0;!F&&i<k.length;i++){K=k[i];if(s.test(K)){g=g+1;if(f.length<t){L=K.replace(s,"<b>$&</b>");d={tile:T.tile,label:L,title:e,icon:I,targetURL:T.url,size:T.size};f.push(d);F=true}}}}r(m(f,g))};_().done(function(d){b(d)})};this.querySuggestions=function(s,r){return a.querySuggestions(s,function(b){b.searchTerm=s;r(b)})};this.search=function(s,r){return a.search(s,r)};this.searchWithCategories=function(s,d,m,r,t,b){return a.searchWithCategories(s,d,m,r,t,b)};this.searchInit=function(){return a.searchInit()};this.setQueryForAll=function(m,f){return a.setQueryForAll(m,f)};this.setSearchTermWithoutQuery=function(s){return a.setSearchTermWithoutQuery(s)};this.searchFireQuery=function(m){return a.searchFireQuery(m)};this.searchAppendNextPage=function(m){return a.searchAppendNextPage(m)};this.setDataSource=function(d,m){return a.setDataSource(d,m)};this.setSearchCategoryTree=function(b){return a.setSearchCategoryTree(b)};this.getSina=function(){return a.getSina()};this.getDataSource=function(){return a.getDataSource()}}}());
