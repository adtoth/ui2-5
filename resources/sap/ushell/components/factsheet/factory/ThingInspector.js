//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.components.factsheet.factory.ThingInspector");var c;if(typeof c==="undefined"){c=sap.ushell.components.factsheet}c.factory=(function(){jQuery.sap.require("sap.suite.ui.commons.UnifiedThingInspector");jQuery.sap.require("sap.ushell.components.factsheet.annotation.Mapping");var t,M={},g,a,b,d,f,h,l,n,p,o={},q,r,s,u,v,w,x,y,z,A,T,R,B,F="displayFactSheet",C="annotation=",E="entity=";jQuery.sap.require("sap.ui.base.Object");jQuery.sap.require("sap.ui.core.format.NumberFormat");var L=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();if(sap.ui.getCore().getConfiguration().getLanguage()=="ZH"){L=new sap.ui.core.Locale("zh_CN")}var S=sap.ui.core.LocaleData.getInstance(L)._get("decimalFormat-short");function D(e){var j="";var k="";var m="";var V=0;var W="";var X=G(e);var Y=Math.pow(10,X.toString().length-1);if(S==null)return sap.ui.core.format.NumberFormat.getIntegerInstance().format(e);if(S[Y]==null||S[Y]==undefined||S[Y]=="0")return sap.ui.core.format.NumberFormat.getIntegerInstance().format(e);j=S[Y];var Z=j.match(/0/g).length;var _=j.substring(0,j.lastIndexOf("0")+1);var a1=j.substring(j.lastIndexOf("0")+1,j.length);a1=a1.replace(/'.'/g,".");k=_;m=X.toString();for(var i=0;i<Z;i+=1){V=k.indexOf("0",V);if(V==-1)break;k=k.substring(0,V)+m[i]+k.substring(V+1);V+=1}if(I(e)){k=H(k)}W=sap.ui.core.format.NumberFormat.getFloatInstance().format(k);W=W+a1;return W}function G(e){var i=Number(e).toFixed(0);if(I(e)){i=Number(i)*-1}return i}function H(e){return Number(e)*-1}function I(e){return e<0?true:false}function J(e,i){var j,k;if(!e){return""}k=new RegExp(sap.ui.core.format.NumberFormat.oDefaultFloatFormat.groupingSeparator,"g");if(i&&i>0){var m=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:i,maxFractionDigits:i},L);j=m.format(e);if(j&&j.length>6){e=e.replace(k,"");return(D(e))}else{return j}}else{if(e&&e.length>6){e=e.replace(k,"");return(D(e))}else{return e}}};function K(){var e,k,m="";var V=this.getElementBinding().sPath.split("/")[1];var W=this.getModel();var X=this.mBindingInfos.value.parameters;var Y=this.mBindingInfos.value.parts;for(var i=0;i<X.length;i++){m=m+X[i].string}for(var j=0;j<Y.length;j++){e=Y[j].path;var Z="{"+e+"}";k=W.oData[V][e];m=m.replace(Z,k)}var _=q(m);if($.isNumeric(_)){var a1=this.mBindingInfos.value.parts.filter(function(b1){return(b1.path==e)});_=J(_,a1[0].type.oFormatOptions.maxFractionDigits);this.setDoubleFontSize(true)}this.setValue(_);this.getElementBinding().detachChange(K)}g=function(e){var j,k,i;j=e.slice(1).split("/");k="/";for(i=0;i<j.length;i+=1){if(j[i].indexOf("(")>0){break}else{k+=j[i]+"/"}}return k};a=function(e,m){var i,j,k,V;j=e.slice(m.sServiceUrl.length+1);if(j.indexOf("/")>=0){k=j.split("/");V=k[k.length];i=k[k.length-1];if(i.indexOf("(")>=0){i=i.slice(i.indexOf("("))}i=this.getNavEntitySet(i,V,m.getMetadata())}else{if(j.indexOf("(")>=0){i=j.slice(0,j.indexOf("("))}else{if(j.indexOf("?")>=0){i=j.slice(0,j.indexOf("?"))}else{i=j}}}return i};v=function(e,m){var i,k,j,V;i=e.slice(m.sServiceUrl.length+1);if(i.indexOf("(")>=0){k=i.slice(i.indexOf("(")+1,i.indexOf(")"));if(k.indexOf("=")<=0){j=m.getServiceMetadata();V=d(a(e,m),j);k=w(V,j)+"="+k}}else{k=new String()}return k};w=function(e,m){var i,k,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){k=m.dataServices.schema[i];if(k.namespace===e.slice(0,e.lastIndexOf("."))){for(j=0;j<k.entityType.length;j+=1){if(k.entityType[j].name===e.slice(e.lastIndexOf(".")+1)){return k.entityType[j].key.propertyRef[0].name}}}}};b=function(e,m){var k=e;for(var i=m.dataServices.schema.length-1;i>=0;i--){var V=m.dataServices.schema[i];if(V.entityContainer){var W=V.entityContainer[0].entitySet;for(var j=W.length-1;j>=0;j--){if(W[j].entityType==k){return W[j].name}}}}};d=function(e,m,W){var i,k,V,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){k=m.dataServices.schema[i];if(k.entityContainer){V=k.entityContainer[0].entitySet;for(j=V.length-1;j>=0;j-=1){if(V[j].name===e){if(W){return V[j].entityType.slice(k.namespace.length+1)}else{return V[j].entityType}}}}}};f=function(e,m,V){var W,i,X,Y,k,j,Z;W=e.split(".");for(i=V.dataServices.schema.length-1;i>=0;i-=1){X=V.dataServices.schema[i];Y=W[0];if(W.length>2){for(k=1;k<W.length-1;k+=1){Y+="."+W[k]}}if(X.namespace===Y){for(j=0;j<X.entityType.length;j+=1){if(X.entityType[j].name===W[W.length-1]){if(X.entityType[j].navigationProperty){for(k=0;k<X.entityType[j].navigationProperty.length;k+=1){if(X.entityType[j].navigationProperty[k].name===m){Z=X.entityType[j].navigationProperty[k];return{name:Z.relationship,toRole:Z.toRole}}}}}}}}};h=function(e,m,V){var W,X,Y,i,Z,j,_,k;W=d(e,V);if(m.charAt(0)==="@"){if(M.termDefinitions&&M.termDefinitions[m]){X=M.termDefinitions[m];if(X.indexOf("Collection")>=0){X=X.slice(X.indexOf("(")+1,X.indexOf(")"))}return b(X,V)}}else{Y=f(W,m,V);if(Y){for(i=V.dataServices.schema.length-1;i>=0;i-=1){Z=V.dataServices.schema[i];if(Z.entityContainer&&Z.entityContainer[0].associationSet){for(j=Z.entityContainer[0].associationSet.length-1;j>=0;j-=1){_=Z.entityContainer[0].associationSet[j];if(_.association===Y.name){for(k=0;k<_.end.length;k+=1){if(_.end[k].role===Y.toRole){return _.end[k].entitySet}}}}}}}}};l=function(e,m,V){var W,X,i,Y,j,Z,k;W=d(e,V);X=f(W,m,V);for(i=V.dataServices.schema.length-1;i>=0;i-=1){Y=V.dataServices.schema[i];for(j=Y.association.length-1;j>=0;j-=1){Z=Y.association[j];if(Y.namespace+'.'+Z.name===X.name){for(k=0;k<Z.end.length;k+=1){if(Z.end[k].role.substr(0,7)==="ToRole_"){return Z.end[k].multiplicity}}}}}};n=function(e,m){var i,j,k,V;i={};if(M.expand){if(M.expand[d(e,m)]){j=M.expand[d(e,m)];k=[];for(V in j){k.push(j[V])}i.expand=k.join(", ")}}return i};p=function(e,m){var V,W={},j;W.parts=[];W.parameters=[];for(j=e.length-1;j>=0;j-=1){if(e[j].Type==="Path"){if(e[j].EdmType){switch(e[j].EdmType){case"Edm.DateTimeOffset":case"Edm.DateTime":W.parts.push({path:e[j].Value,type:new sap.ui.model.type.DateTime()});break;case"Edm.Time":W.parts.push({path:e[j].Value+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"}})});break;case"Edm.Date":W.parts.push({path:e[j].Value,type:new sap.ui.model.type.Date()});break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":W.parts.push({path:e[j].Value,type:new sap.ui.model.type.Float()});break;case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":W.parts.push({path:e[j].Value,type:new sap.ui.model.type.Integer()});break;default:W.parts.push({path:e[j].Value});break}}else{W.parts.push({path:e[j].Value})}}else if(e[j].Type==="String"){W.parameters.unshift({string:e[j].Value})}}W.formatter=function(){var X="",Y,k,i;V=this;if(arguments&&arguments.length>=1){Y=arguments.length-1;if(arguments[Y]){for(k=0;k<e.length;k+=1){if(e[k].Type==="Path"){X+=arguments[Y];Y-=1}else{X+=e[k].Value}}if(m){X=m(X)}}return X}};return W};var N=function(e,i){for(var k in e){if(k=='__metadata'){continue}else if(k==i){return e[k]}else if(typeof e[k]==='object'){return N(e[k],i)}}};q=function(e){var i,j,k,m={},V;i=e.lastIndexOf("/");j=e.slice(0,i);k=e.slice(i+1);if(!o[e]){m=new sap.ui.model.json.JSONModel();m.loadData(j,null,false);o[e]=m.getData()}else{m=o[e]}if(o[e]&&o[e].d){if(!o[e].d[k]){V=N(o[e].d,k)}else{V=o[e].d[k]}}return V};r=function(e,i,m){var j,k;j=new sap.ui.core.Control();k=u(e.Value,e.EdmType,i);if(e.Value&&e.Value["com.sap.vocabularies.UI.v1.IsImageURL"]){j=new sap.m.Image({height:"50px"});if(k.BindingInfo){j.bindProperty("src",k.BindingInfo)}else{j.setProperty("src",k.String)}}else{if(e.UrlRef||(e.Target&&e.Target.Path)){j=new sap.m.Link()}else{j=new sap.m.Text()}if(k.BindingInfo){j.bindProperty("text",k.BindingInfo)}else{j.setProperty("text",k.String)}if(e.EdmType==="Edm.Decimal"||e.EdmType==="Edm.Double"||e.EdmType==="Edm.Single"||e.EdmType==="Edm.Int16"||e.EdmType==="Edm.Int32"||e.EdmType==="Edm.Int64"){j.setTextAlign(sap.ui.core.TextAlign.End)}}if((e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithNavigation")&&m){var V=e.Target.Path;if(M[i][V.slice(1)]){j.bindProperty("href",x(i,V,m))}j.attachPress(function(W){W.preventDefault();W.stopPropagation()})}return j};s=function(e,i,m,W){var V=new sap.m.Label(i);var X="";if(W){X=":"}if(e.Label){if(e.Label.String){V.setText(e.Label.String+X)}else{if(e.Label.Path){V.bindProperty("text",e.Label.Path)}}}else{if(e.Value){var Y=new String();if(e.Value.Path&&m){var Z=m[e.Value.Path];for(var j in Z){if(j="http://www.sap.com/Protocols/SAPData"){if(Z[j].label){Y=Z[j].label;break}}}}else if(e.Value.Apply&&e.Value.Apply.Name=="odata.concat"){for(var k in e.Value.Apply.Parameters){var _=e.Value.Apply.Parameters[k];if(_.Type=="Path"){var Z=m[_.Value];for(var j in Z){if(j="http://www.sap.com/Protocols/SAPData"){if(Z[j].label){Y=Z[j].label;break}}}break}}}V.setText(Y+X)}}return V};var u=function(e,k,m){if(!e){return false}var V={};if(e.Apply){if(e.Apply.Name="odata.concat"){if(m&&M.propertyAnnotations&&M.propertyAnnotations[m]){var W=M.propertyAnnotations[m];var X=e.Apply.Parameters;var Y=[];for(j=0;j<X.length;j+=1){if(X[j].Type==="Path"){Y.push(X[j]);if(W&&W[X[j].Value]&&W[X[j].Value]["Org.OData.Measures.V1.ISOCurrency"]){Y.push({Type:"String",Value:" "});if(W[X[j].Value]["Org.OData.Measures.V1.ISOCurrency"].Path){Y.push({Type:"Path",Value:W[X[j].Value]["Org.OData.Measures.V1.ISOCurrency"].Path})}else{Y.push({Type:"String",Value:W[X[j].Value]["Org.OData.Measures.V1.ISOCurrency"].String})}}else{if(W&&W[X[j].Value]&&W[X[j].Value]["Org.OData.Measures.V1.Unit"]){Y.push({Type:"String",Value:" "});if(W[X[j].Value]["Org.OData.Measures.V1.Unit"].Path){Y.push({Type:"Path",Value:W[X[j].Value]["Org.OData.Measures.V1.Unit"].Path})}else{Y.push({Type:"String",Value:W[X[j].Value]["Org.OData.Measures.V1.Unit"].String})}}}}else{Y.push(X[j])}}V.BindingInfo=p(Y)}else{V.BindingInfo=p(e.Apply.Parameters)}}}else{if(e.Path){if(e.Path.charAt(0)=="@"){var Z=M[m][e.Path.slice(1,e.Path.indexOf("/"))].UrlRef;var _=e.Path.slice(e.Path.indexOf("/")+1);var a1=[];if(Z&&Z.Apply){var b1=Z.Apply.Parameters;switch(Z.Apply.Name){case"odata.concat":a1=b1;a1.push({Type:"String",Value:"/"+_});break;case"odata.fillUriTemplate":var c1=b1[0].Value.split("{");for(var i in c1){if(c1[i].indexOf("}")<0){a1.push({Type:"String",Value:c1[i]})}else{var d1=c1[i].split("}");for(var j=1;j<b1.length;j+=1){if(b1[j].Name==d1[0]){var e1=b1[j].Value;if(e1.Path){a1.push({Type:"Path",Value:e1.Path})}else{if(e1.Apply&&e1.Apply.Name=="odata.UriEncode"){var f1=e1.Apply.Parameters[0];a1.push({Type:f1.Type,Value:encodeURIComponent(f1.Value)});a1.push({Type:"String",Value:"{"+encodeURIComponent(f1.Value)+"}"})}}}}a1.push({Type:"String",Value:d1[1]})}}a1.push({Type:"String",Value:"/"+_});V.fnChange=K;break;default:break}V.BindingInfo=p(a1,q)}else{if(Z&&Z.Path){a1.push({Type:"Path",Value:Z.Path},{Type:"String",Value:"/"+_});V.BindingInfo=p(a1,q)}else{if(Z&&Z.String){V.String=q(Z.String+"/"+_)}}}}else{V.BindingInfo={};var g1;switch(k){case"Edm.DateTimeOffset":case"Edm.DateTime":V.BindingInfo={path:e.Path,type:new sap.ui.model.type.DateTime()};break;case"Edm.Time":V.BindingInfo={path:e.Path+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"}})};break;case"Edm.Date":V.BindingInfo={path:e.Path,type:new sap.ui.model.type.Date()};break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":if((k==="Edm.Decimal")||(k==="Edm.Double")||(k==="Edm.Single")){g1=new sap.ui.model.type.Float()}else if((k==="Edm.Int16")||(k==="Edm.Int32")||(k==="Edm.Int64")){g1=new sap.ui.model.type.Integer()}if(M.propertyAnnotations){var h1=[];var W=M.propertyAnnotations[m];h1.push({Type:"Path",Value:e.Path,EdmType:k},{Type:"String",Value:" "});if(W&&W[e.Path]&&W[e.Path]["Org.OData.Measures.V1.ISOCurrency"]){if(W[e.Path]["Org.OData.Measures.V1.ISOCurrency"].Path)h1.push({Type:"Path",Value:W[e.Path]["Org.OData.Measures.V1.ISOCurrency"].Path});else h1.push({Type:"String",Value:W[e.Path]["Org.OData.Measures.V1.ISOCurrency"].String})}else{if(W&&W[e.Path]&&W[e.Path]["Org.OData.Measures.V1.Unit"]){if(W[e.Path]["Org.OData.Measures.V1.Unit"].Path)h1.push({Type:"Path",Value:W[e.Path]["Org.OData.Measures.V1.Unit"].Path});else h1.push({Type:"String",Value:W[e.Path]["Org.OData.Measures.V1.Unit"].String})}}V.BindingInfo=p(h1)}else{V.BindingInfo={path:e.Path,type:g1}}break;default:V.BindingInfo={path:e.Path};break}}}else{if(e.String){V.String=e.String}}}return V};x=function(e,i,m){var k={},V=[],W,X,Y,j,Z,_={},j,a1,b1,c1;if(i.charAt(0)==="@"){if(i.indexOf("/")<0){k=M[e][i.slice(1)].UrlRef}else{k=M[e][i.slice(1,i.indexOf("/"))].UrlRef;X=i.slice(i.indexOf("/")+1)}if(k&&k.Apply){W=k.Apply.Parameters;switch(k.Apply.Name){case"odata.fillUriTemplate":Y=W[0].Value.split("{");for(j=0;j<Y.length;j+=1){if(Y[j].indexOf("}")<0){V.push({"Value":Y[j],"Type":"String"})}else{Z=Y[j].split("}");_={};_.Value=Z[0];_.Type="Path";for(j=1;j<W.length;j+=1){if(W[j].Name===_.Value){a1=W[j].Value;if(a1.Path){_.Value=a1.Path}else{if(a1.Apply&&a1.Apply.Name==="odata.UriEncode"){_.Value=a1.Apply.Parameters[0].Value}}break}}V.push(_);V.push({"Value":Z[1],"Type":"String"})}}for(c1 in M.aliasAnnotations){if(W[0].Value.indexOf("/"+c1+"/")>=0){b1=M.aliasAnnotations[c1];break}}break;default:break}}return p(V)}};y=function(e){var i=sap.ui.core.TextAlign.Begin;if(e.EdmType==="Edm.Decimal"||e.EdmType==="Edm.Double"||e.EdmType==="Edm.Single"||e.EdmType==="Edm.Int16"||e.EdmType==="Edm.Int32"||e.EdmType==="Edm.Int64"){i=sap.ui.core.TextAlign.End}return i};var z=function(m,e,k,V,W,X,Y){if(!X){var X=m.getServiceMetadata()}if(!V)V=[];var Z=d(e,X);if(!Y){Y=["50%","50%"]}var _=new sap.m.Table({backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.None,columns:[new sap.m.Column({width:Y[0],hAlign:sap.ui.core.TextAlign.End}),new sap.m.Column({width:Y[1]})]});_.addStyleClass("sapFactsheetUtiTilePadding");var a1=Z.substr(Z.indexOf(".")+1);var b1=(M.propertyExtensions)?M.propertyExtensions[Z]:[];var j=0;var c1=0;var d1=0;var e1=0;if(W&&W.High){c1=W.High}if(W&&W.Medium){d1=W.Medium}if(W&&W.Low){e1=W.Low}for(var i=0;i<V.length;i+=1){if(W&&V[i].Importance&&V[i].Importance.EnumMember==="com.sap.vocabularies.UI.v1.Priority/High"){if(c1){c1-=1}else{continue}}else if(W&&V[i].Importance&&V[i].Importance.EnumMember==="com.sap.vocabularies.UI.v1.Priority/Medium"){if(d1){d1-=1}else{continue}}else if(W&&V[i].Importance&&V[i].Importance.EnumMember==="com.sap.vocabularies.UI.v1.Priority/Low"){if(e1){e1-=1}else{continue}}if(W&&W.Total&&j>=W.Total){break}j+=1;var f1=new sap.ui.core.Control().setModel(m);var g1=s(V[i],{textAlign:sap.ui.core.TextAlign.End},b1,true);g1.addStyleClass("sapFactsheetUtiLabel");f1=r(V[i],Z,X);_.addItem(new sap.m.ColumnListItem({cells:[g1,f1]}))}return _};var O=function(m,e,j,k,V){var W=m.getServiceMetadata();var X=new String();switch(k.RecordType){case"com.sap.vocabularies.UI.v1.ReferenceFacet":var Y=new sap.suite.ui.commons.UnifiedThingGroup();if(k.Label&&k.Label.String)Y.setTitle(k.Label.String);var Z=k.Target.AnnotationPath;var _=Z.substring(Z.lastIndexOf("@")+1);Z=Z.substring(0,Z.lastIndexOf("@")-1);if(Z){X=l(e,Z,W)}var a1=_.split("#");switch(a1[0]){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Badge":case"com.sap.vocabularies.UI.v1.Identification":if(Z){var b1=h(e,Z,W);if(X=="*"&&a1[0]!="com.sap.vocabularies.UI.v1.Identification"){if(Z.charAt(0)!="@"){var c1=P(m,b1,j,W,Z,V+"/"+Z,k);Y.setContent(c1)}}else{if(a1[0]=="com.sap.vocabularies.UI.v1.Identification"){var d1=M[d(b1,W)]["com.sap.vocabularies.UI.v1.HeaderInfo"];var e1=M[d(b1,W)]["com.sap.vocabularies.UI.v1.Identification"];var f1=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(m);f1.addContent(z(m,b1,j,e1)).addStyleClass("sapFactsheetUtiPanel").bindElement(V+"/"+Z);Y.setContent(f1)}else{Y.setContent(new sap.m.Text({text:"You should use Identification for 1:1 relations."}))}}}else{if(X=="*"){var c1=P(m,e,j,W,Z,V+"/"+Z,k);Y.setContent(c1)}else{if(a1[0]=="com.sap.vocabularies.UI.v1.Identification"){var g1=M[d(e,W)]["com.sap.vocabularies.UI.v1.HeaderInfo"];var e1=M[d(e,W)]["com.sap.vocabularies.UI.v1.Identification"];var f1=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(m);f1.addContent(z(m,e,j,e1).addStyleClass("sapFactsheetUtiPanel"));Y.setContent(f1)}else{Y.setContent(new sap.m.Text({text:"You should use Identification for 1:1 relations."}))}}}break;case"com.sap.vocabularies.UI.v1.StatusInfo":if(Z){var b1=h(e,Z,W);var h1=M[d(b1,W)]["com.sap.vocabularies.UI.v1.StatusInfo"];Y.setContent(z(m,b1,j,h1).addStyleClass("sapFactsheetUtiPanel").bindElement(V+"/"+Z))}else{var h1=M[d(e,W)]["com.sap.vocabularies.UI.v1.StatusInfo"];Y.setContent(z(m,e,j,h1).addStyleClass("sapFactsheetUtiPanel"))}break;case"com.sap.vocabularies.UI.v1.FieldGroup":var i1=M[d(e,W)][_];if(i1){if(!Y.getTitle()||Y.getTitle()==""){if(i1.Label){if(i1.Label.String){Y.setTitle(i1.Label.String)}else{if(i1.Label.Path)Y.bindProperty("title",i1.Label.Path)}}}if(Z){var b1=h(e,Z,W);Y.setContent(z(m,b1,j,i1.Data).addStyleClass("sapFactsheetUtiPanel").bindElement(V+"/"+Z))}else{Y.setContent(z(m,e,j,i1.Data).addStyleClass("sapFactsheetUtiPanel"))}}break;default:Y.setContent(new sap.m.Text({text:"not yet implemented"}));break}return Y;break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":var Y=new sap.ui.ux3.ThingGroup({title:k.Label.String});Y.setContent(A(k));return Y;break;case"com.sap.vocabularies.UI.v1.CollectionFacet":var j1=[];for(var i=0;i<k.Facets.length;i+=1){j1.push(O(m,e,j,k.Facets[i],V))}return j1;break;default:return new sap.suite.ui.commons.UnifiedThingGroup().setContent(new sap.m.Text({text:"Not yet implemented"}));break}};A=function(e){var i,j,k;switch(e.UrlContentType.String){case"image/png":case"image/jpeg":case"image/gif":i=new sap.m.Image({width:"100%"});if(e.Url.String){i.setSrc(e.Url.String)}return i;default:j=new sap.ui.core.HTML();if(e.Url.String){j.setContent("<iframe src = '"+e.Url.String+"' width='100%' height='250px' frameborder='0'></iframe>")}else{if(e.Url.Path){j.bindProperty("content",{path:e.Url.Path,formatter:function(m){k="<iframe src = '"+e.Url.Path+"' width='100%' height='250px' frameborder='0'></iframe>";return k}})}}return j}};var P=function(m,e,j,k,V,W,X){if(!k){k=m.getServiceMetadata()}var Y=d(e,k);var Z=Y.substr(Y.indexOf(".")+1);var _=(M.propertyExtensions)?M.propertyExtensions[Y]:[];var a1=M[Y]["com.sap.vocabularies.UI.v1.LineItem"];var b1=6;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){b1=5}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){b1=4}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){b1=4}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){b1=3}var c1=0;var d1=0;for(var i=0;i<a1.length;i+=1){if(a1[i].Importance&&(a1[i].Importance.EnumMember==="com.sap.vocabularies.UI.v1.Priority/High")){c1+=1}}if(b1>c1){d1=b1-c1}var e1=[];var f1=[];var g1=[];var h1=[];var i1;var j1;f1.push(new sap.m.Column({visible:false}));e1.push(new sap.m.Text().bindText("__metadata/uri"));for(var i=0;i<a1.length;i+=1){var k1=new sap.ui.core.Control();k1=r(a1[i],Y,k);i1=s(a1[i],null,_);g1.push(i1);h1.push(k1);if(a1[i].Importance&&(a1[i].Importance.EnumMember==="com.sap.vocabularies.UI.v1.Priority/High")){if(c1>0){j1=true;c1-=1}else{j1=false}}else if(a1[i].Importance&&(a1[i].Importance.EnumMember==="com.sap.vocabularies.UI.v1.Priority/Medium")){if(d1>0){j1=true;d1-=1}else{j1=false}}else{j1=false}f1.push(new sap.m.Column({header:i1,hAlign:y(a1[i]),visible:j1}));e1.push(k1)}var l1=new sap.m.ColumnListItem({type:sap.m.ListType.Navigation,unread:false,cells:e1,});var m1;if(X){m1=X.Label.String}l1.attachPress({aColumns:a1,aLabels:g1,aControls:h1,sTitle:m1},function(p1,q1){var r1={};r1.items={};var s1=p1.getSource().getCells()[0].getText().substr(p1.getSource().getCells()[0].getText().lastIndexOf("/"));var t1=new sap.m.Table({backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.None,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.End}),new sap.m.Column()]});t1.addStyleClass("sapFactsheetUtiPanel");t1.addStyleClass("sapFactsheetUtiTilePadding");t1.bindElement(s1);var i1;for(var i=0;i<a1.length;i+=1){i1=g1[i].clone();i1.setText(i1.getText()+":");t1.addItem(new sap.m.ColumnListItem({cells:[i1,h1[i].clone()]}))}var u1="";if(t.getName()&&t.getDescription())u1=t.getName()+", "+t.getDescription();else if(t.getName()&&!t.getDescription())u1=t.getName();else if(!t.getName()&&t.getDescription())u1=t.getDescription();var v1=new sap.suite.ui.commons.UnifiedThingGroup({content:t1,title:m1,description:u1});var w1=new sap.m.Page({title:t.getTitle(),showNavButton:true,content:[v1]});t.navigateToPage(w1,true)});var n1=new sap.m.Table({growing:true,columns:f1});n1.setModel(m);n1.bindItems({path:W,template:l1});n1.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"));var o1=function(){if(this.getItems().length===0){this.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons").getText("FACETOVERVIEW_NO_CONTENT_TEXT"))}else{this.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"))}};n1.attachUpdateFinished(o1);return n1};var Q=function(i){i=i||1;if(jQuery.device.is.phone){return(7*i)+"rem"}else{return(11*i-1)+"rem"}};var U=function(e){var i,j=0,k=0,m=0;for(i=0;i<e.length;i+=1){if(e[i].Importance){switch(e[i].Importance.EnumMember){case"com.sap.vocabularies.UI.v1.Priority/High":j+=1;break;case"com.sap.vocabularies.UI.v1.Priority/Medium":k+=1;break;case"com.sap.vocabularies.UI.v1.Priority/Low":m+=1}}}return{High:j,Medium:k,Low:m}};B=function(e,V,t,W){var X,Y,Z,_,a1,b1,c1,d1,e1,f1,i,g1={},h1,i1,j1,k1,l1,m1,n1,o1,p1,q1,r1,j,k,s1,t1,u1,v1,w1,x1,v1,y1,z1;X=g(e);Y=new sap.ui.model.odata.ODataModel(X,true);Y.setCountSupported(false);t.setModel(Y);Z=a(e,Y);_="/"+e.slice(X.length);a1=Y.getServiceMetadata();var A1=V.substring(0,V.substring(0,V.lastIndexOf("/")).lastIndexOf("/"));var B1=V.substring(V.substring(0,V.lastIndexOf("/")).lastIndexOf("/"));B1=B1.toLowerCase();M=c.annotation.Mapping.parse(a1,A1+B1);b1=d(Z,a1);c1=M[b1]["com.sap.vocabularies.UI.v1.HeaderInfo"];d1=M[b1]["com.sap.vocabularies.UI.v1.Facets"];w1=["40%","60%"];t.bindElement(_,n(Z,a1));var C1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var D1=0;for(var E1 in M[b1]){if(E1.search("com.sap.vocabularies.UI.v1.DataPoint")!=-1){var F1=M[b1][E1];if(F1){var G1=false;var H1=new sap.suite.ui.commons.KpiTile({doubleFontSize:false,});var I1=0;var J1;if(F1.ValueFormat){J1=new sap.ui.model.type.Float({minFractionDigits:F1.ValueFormat.NumberOfFractionalDigits.Int,maxFractionDigits:F1.ValueFormat.NumberOfFractionalDigits.Int});I1=F1.ValueFormat.NumberOfFractionalDigits.Int}else J1=undefined;if(F1.Title&&F1.Title.String){H1.setDescription(F1.Title.String)}else{if(F1.Title&&F1.Title.Path){H1.bindProperty("description",{path:F1.Title.Path})}}if(F1.Value&&F1.Value.String){H1.setValue(F1.Value.String)}else{if(F1.Value&&F1.Value.Path){var K1=u(F1.Value,F1.Value.EdmType,b1);if(K1.fnChange){H1.setModel(Y);H1.bindElement(_);H1.getElementBinding().attachChange(K1.fnChange,H1)}if(K1.String){if($.isNumeric(K1.String)){G1=true;H1.setValue(J(K1.String,I1))}else{H1.setValue(K1.String)}}else if(K1.BindingInfo){var e1=K1.BindingInfo;if(e1.parts&&e1.parts.length==2){H1.bindProperty("valueUnit",e1.parts[0]);if(I1>0){e1.parts[1].type=J1}else{e1.parts[1].formatter=J;e1.parts[1].type=J1}H1.bindProperty("value",e1.parts[1])}else if(e1.parts&&e1.parts.length==1){if(I1>0)e1.parts[0].type=J1;else e1.parts[0].formatter=J;H1.bindProperty("value",e1)}else{H1.bindProperty("value",e1)}}}}if(F1.Value.EdmType==="Edm.Decimal"||F1.Value.EdmType==="Edm.Double"||F1.Value.EdmType==="Edm.Single"||F1.Value.EdmType==="Edm.Int16"||F1.Value.EdmType==="Edm.Int32"||F1.Value.EdmType==="Edm.Int64"||G1==true){H1.setDoubleFontSize(true)}t.addKpi(H1);D1+=1}}if(D1>=3)break}if(c1.TypeName.String){t.setTitle(c1.TypeName.String)}else{if(c1.TypeName.Path){t.bindProperty("title",{path:c1.TypeName.Path})}}if(c1.Title.Value.String){t.setName(c1.Title.Value.String)}else{t.bindProperty("name",u(c1.Title.Value,c1.Title.EdmType,b1).BindingInfo)}if(c1.Description&&c1.Description.Value){if(c1.Description.Value.String){t.setDescription(c1.Description.Value.String)}else{t.bindProperty("description",u(c1.Description.Value,c1.Description.EdmType,b1).BindingInfo)}}if(c1.ImageUrl&&c1.ImageUrl.String){t.setIcon(c1.ImageUrl.String)}else{if(c1.ImageUrl&&c1.ImageUrl.Path){t.bindProperty("icon",{path:c1.ImageUrl.Path})}}for(i=0;i<d1.length;i+=1){if(d1[i]["com.sap.vocabularies.UI.v1.IsSummary"]){t1=d1[i];break}}if(t1){var L1=17;var M1=0;var N1=0;var O1=0;var P1=[];var Q1=[];for(var j=0;j<t1.Facets.length;j+=1){var R1=t1.Facets[j].Target.AnnotationPath.substring(t1.Facets[j].Target.AnnotationPath.lastIndexOf("@")+1);var h1=t1.Facets[j].Target.AnnotationPath;h1=h1.substring(0,h1.lastIndexOf("@")-1);t1.Facets[j].NavPath=h1;var S1=h(Z,h1,a1);t1.Facets[j].NavEntitySet=S1;var T1;if(S1){T1=S1}else{T1=Z}t1.Facets[j].EntitySet=T1;var U1=d(S1,a1);var V1;if(U1){V1=U1}else{V1=b1}t1.Facets[j].EntityType=V1;var W1=[];if(M[V1][R1].length){W1=M[V1][R1]}else if(M[V1][R1].Data.length){W1=M[V1][R1].Data}t1.Facets[j].Content=W1;for(var i=0;i<W1.length;i+=1){if(W1[i].Importance&&(W1[i].Importance.EnumMember==="com.sap.vocabularies.UI.v1.Priority/High")){M1+=1}else if(W1[i].Importance&&(W1[i].Importance.EnumMember==="com.sap.vocabularies.UI.v1.Priority/Medium")){N1+=1}}}if((M1+N1)>L1){N1=L1-M1;if(N1<0){N1=0}}if(jQuery.device.is.phone){N1=0}var X1=L1-M1-N1;var Y1=[];var Z1;var $1=N1+M1;var _1;for(var j=0;j<t1.Facets.length;j+=1){_1=z(Y,t1.Facets[j].EntitySet,V,t1.Facets[j].Content,{High:M1,Medium:N1,Low:0},null,w1).addStyleClass("sapFactsheetUtiTilePadding").addStyleClass("sapFactsheetUtiTable");if(j>0){_1.addStyleClass("sapFactsheetUtiPaddingTop")}if(t1.Facets[j].NavPath){_1.bindElement(_+"/"+t1.Facets[j].NavPath)}Z1=U(t1.Facets[j].Content);M1-=Z1.High;N1-=Z1.Medium;if(((Z1.High>0)&&((M1+Z1.High)>0))||((Z1.Medium>0)&&((N1+Z1.Medium)>0))){Y1.push(_1);if(j>0){if(X1>0){X1-=1}else if(N1>0){N1-=1}else if(M1>0){M1-=1}}}if((M1<1)&&(N1<1)){break}}if(M1<0){M1=0}if(N1<0){N1=0}var g1=new sap.ui.layout.VerticalLayout({content:Y1});var a2=Q();var b2=1;if(($1>3)&&($1<=9)){a2=Q(2);b2=2}else if($1>9){a2=Q(3);b2=3}c2=new sap.suite.ui.commons.FacetOverview({title:C1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"),height:a2,rowSpan:b2,content:g1});c2.attachPress({facets:t1},function(m2,n2){t.removeAllFacetContent();for(i=0;i<n2.facets.Facets.length;i+=1){var g1=O(Y,Z,V,n2.facets.Facets[i],_);if(i===0){var o2="";if(t.getName()&&t.getDescription())o2=t.getName()+", "+t.getDescription();else if(t.getName()&&!t.getDescription())o2=t.getName();else if(!t.getName()&&t.getDescription())o2=t.getDescription();g1.setDescription(o2)}else{g1.setDescription(g1.getTitle());g1.setTitle("")}t.addFacetContent(g1)}t.navigateToDetail()});t.addFacet(c2)}m1=function(q1){return function(m2){var n2=new sap.ui.model.json.JSONModel();var o2=d(Z,a1);var p2=M[q1.navigationType]["com.sap.vocabularies.UI.v1.Badge"];if(q1.cardinality=="*"){if(m2.results&&m2.results.length){n2.setData(m2);var q2=function(G2,H2){var w2=r(p2.Title,q1.navigationType,a1);var I2=H2.oModel.oData.results[H2.sPath.substring(H2.sPath.lastIndexOf("/")+1)];if(p2.Title.RecordType&&(p2.Title.RecordType==="com.sap.vocabularies.UI.v1.DataField")){w2.addStyleClass("sapFactsheetUtiLabel")}if(p2.MainInfo){var z2=r(p2.MainInfo,q1.navigationType,a1)}else{var z2=new sap.m.Text({text:""})}var J2=new sap.ui.layout.HorizontalLayout();if(I2[p2.Title.Value.Path]||p2.Title.Value.Apply){J2.addContent(w2);if(p2.MainInfo){J2.addContent(new sap.m.Text({text:" - "}).addStyleClass("sapFactsheetUtiSeparatorPadding"))}}if(p2.MainInfo){J2.addContent(z2)}return new sap.m.ColumnListItem({cells:[J2]})};var g1=new sap.m.Table({backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.None,columns:[new sap.m.Column({width:"100%"})],items:{path:"/results",factory:q2}});g1.setModel(n2);g1.addStyleClass("sapFactsheetUtiTilePadding");g1.addStyleClass("sapFactsheetUtiTable");var r2=parseInt(m2.__count);if(Number(r2)){q1.facet.setQuantity(r2);q1.facet.setContent(g1)}}else{q1.facet.setQuantity(0)}}else{n2.setData({result:m2});var s2=new sap.ui.layout.VerticalLayout();var t2=(M.propertyExtensions)?M.propertyExtensions[q1.navigationType]:[];var u2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");var v2=s(p2.Title,{},t2,true).addStyleClass("sapFactsheetUtiLabelMargin");var w2=r(p2.Title,q1.navigationType,a1).setModel(n2).bindElement("/result");u2.addContent(v2);u2.addContent(w2);s2.addContent(u2);if(p2.MainInfo){var x2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");var y2=s(p2.MainInfo,{},t2,true).addStyleClass("sapFactsheetUtiLabelMargin");var z2=r(p2.MainInfo,q1.navigationType,a1).setModel(n2).bindElement("/result");x2.addContent(y2);x2.addContent(z2);s2.addContent(x2)}if(p2.SecondaryInfo){var A2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");var B2=s(p2.SecondaryInfo,{},t2,true).addStyleClass("sapFactsheetUtiLabelMargin");var C2=r(p2.SecondaryInfo,q1.navigationType,a1).setModel(n2).bindElement("/result");A2.addContent(B2);A2.addContent(C2);s2.addContent(A2)}if(p2.TypeImageUrl){var D2=new sap.ui.layout.HorizontalLayout();var E2="64px";if(jQuery.device.is.phone){E2="48px"}var F2=new sap.ui.core.Icon({size:E2,width:E2});F2.addStyleClass("sapFactsheetUtiRelIcon");if(p2.TypeImageUrl&&p2.TypeImageUrl.String){F2.setSrc(p2.TypeImageUrl.String)}else{if(p2.TypeImageUrl&&p2.TypeImageUrl.Path){F2.bindProperty("src",p2.TypeImageUrl.Path)}}D2.addContent(F2);D2.addContent(s2);q1.facet.setContent(D2)}else{q1.facet.setContent(s2)}}}};var c2;var d2;for(var i=0;i<d1.length;i+=1){if(d1[i].Target){var h1=d1[i].Target.AnnotationPath;h1=h1.substring(0,h1.lastIndexOf("@")-1);if(h1){var e2=b1.split(".");for(var m=a1.dataServices.schema.length-1;m>=0;m--){var f2=a1.dataServices.schema[m];var g2=e2[0];if(e2.length>2){for(var k=1;k<e2.length-1;k+=1){g2+="."+e2[k]}}if(f2.namespace==g2){for(var j=0;j<f2.association.length;j+=1){if(f2.association[j].name==h1){d2=f2.association[j].end[1].type}}}}c2=new sap.suite.ui.commons.FacetOverview({title:d1[i].Label.String,height:Q(),});c2.attachPress({facet:d1[i]},function(m2,n2){t.removeAllFacetContent();var g1=O(Y,Z,V,n2.facet,_);var o2="";if(t.getName()&&t.getDescription())o2=t.getName()+", "+t.getDescription();else if(t.getName()&&!t.getDescription())o2=t.getName();else if(!t.getName()&&t.getDescription())o2=t.getDescription();g1.setDescription(o2);t.addFacetContent(g1);t.navigateToDetail()});var h2=l(Z,h1,a1);q1={cardinality:h2,navigationPath:h1,facet:c2,navigationType:d2,metadata:a1};var i2;if(h2=="*"){i2=["$inlinecount=allpages","$top=3"]}else{i2=[]}Y.read(_+"/"+h1,"",i2,true,m1(q1));t.addFacet(c2)}}}t.setActionsVisible(true);var j2=new sap.m.Button({text:C1.getText("UNIFIEDTHINGINSPECTOR_FOOTER_BUTTON_EMAIL_LINK"),icon:"sap-icon://email",press:function(oE){sap.m.URLHelper.triggerEmail("",t.getName(),window.location.href)}});y1=new sap.m.ActionSheet({placement:sap.m.PlacementType.Top});y1.addButton(new sap.ushell.ui.footerbar.JamDiscussButton());y1.addButton(new sap.ushell.ui.footerbar.JamShareButton({}));var k2=new sap.ushell.ui.footerbar.AddBookmarkButton();var l2=function(){k2.setAppData({title:t.getTitle(),subtitle:t.getName()+" - "+t.getDescription()});k2.setEnabled(true);if(jQuery.device.is.desktop){u1=new sap.ui.model.odata.ODataModel("/sap/opu/odata/UI2/INTEROP",true);x1="/SemanticObjects('"+d(Z,a1,true)+"')/Links";v1=new sap.suite.ui.commons.LinkActionSheet({showCancelButton:true,placement:sap.m.PlacementType.Top});s1=v(e,Y);var m2=s1.split(",");for(i=0;i<m2.length;i+=1){m2[i]=m2[i].replace("='","=","g");if(m2[i].lastIndexOf("'")==m2[i].length-1)m2[i]=m2[i].slice(0,-1)}for(var n2 in M[b1]){if(n2.indexOf("com.sap.vocabularies.Common.v1.SecondaryKey")==0){var o2=M[b1][n2];for(i=0;i<o2.length;i+=1){var p2=Y.getContext(_).getProperty(o2[i].PropertyPath);if(p2){m2.push(o2[i].PropertyPath+"="+p2)}}}}s1=m2.join("&");u1.read(x1,"","",true,function(q2){var i,r2;if(q2&&q2.results){for(i=0;i<q2.results.length;i+=1){if(q2.results[i].id.indexOf(F)<0){r2="#"+q2.results[i].id+"?"+s1;v1.addItem(new sap.m.Link({text:q2.results[i].text,href:r2}));t.setTransactionsVisible(true)}}}});t.attachTransactionsButtonPress(function(q2){v1.openBy(q2.getParameter("caller"))})}this.detachChange(l2)};t.getElementBinding().attachChange(l2);y1.addButton(k2);y1.addButton(j2);t.attachActionsButtonPress(function(m2){y1.openBy(m2.getParameter("caller"))});z1=new sap.m.ActionSheet({placement:sap.m.PlacementType.Top});z1.addButton(new sap.ushell.ui.footerbar.AboutButton());z1.addButton(new sap.ushell.ui.footerbar.LoginDetailsButton());z1.addButton(new sap.ushell.ui.footerbar.LogoutButton());t.attachConfigurationButtonPress(function(m2){z1.openBy(m2.getParameter("caller"))});t.attachBackAction(function(m2){history.back()});return t};return{ThingViewer:function(i,j){try{t=B(i,j,new sap.suite.ui.commons.UnifiedThingInspector())}catch(e){throw e}return t}}})()}());
