/*
Author:       Mike Adair madairATdmsolutions.ca
              Richard Greenwood rich@greenwoodmap.com
License:      LGPL as per: http://www.gnu.org/copyleft/lesser.html

$Id: Proj.js 2956 2007-07-09 12:17:52Z steven $
*/
var Proj4js={defaultDatum:'WGS84',transform:function(s,d,p){if(!s.readyToUse){this.reportError("Proj4js initialization for:"+s.srsCode+" not yet complete");return p}if(!d.readyToUse){this.reportError("Proj4js initialization for:"+d.srsCode+" not yet complete");return p}if(s.datum&&d.datum&&(((s.datum.datum_type==Proj4js.common.PJD_3PARAM||s.datum.datum_type==Proj4js.common.PJD_7PARAM)&&d.datumCode!="WGS84")||((d.datum.datum_type==Proj4js.common.PJD_3PARAM||d.datum.datum_type==Proj4js.common.PJD_7PARAM)&&s.datumCode!="WGS84"))){var w=Proj4js.WGS84;this.transform(s,w,p);s=w}if(s.axis!="enu"){this.adjust_axis(s,false,p)}if(s.projName=="longlat"){p.x*=Proj4js.common.D2R;p.y*=Proj4js.common.D2R}else{if(s.to_meter){p.x*=s.to_meter;p.y*=s.to_meter}s.inverse(p)}if(s.from_greenwich){p.x+=s.from_greenwich}p=this.datum_transform(s.datum,d.datum,p);if(d.from_greenwich){p.x-=d.from_greenwich}if(d.projName=="longlat"){p.x*=Proj4js.common.R2D;p.y*=Proj4js.common.R2D}else{d.forward(p);if(d.to_meter){p.x/=d.to_meter;p.y/=d.to_meter}}if(d.axis!="enu"){this.adjust_axis(d,true,p)}return p},datum_transform:function(s,d,p){if(s.compare_datums(d)){return p}if(s.datum_type==Proj4js.common.PJD_NODATUM||d.datum_type==Proj4js.common.PJD_NODATUM){return p}if(s.es!=d.es||s.a!=d.a||s.datum_type==Proj4js.common.PJD_3PARAM||s.datum_type==Proj4js.common.PJD_7PARAM||d.datum_type==Proj4js.common.PJD_3PARAM||d.datum_type==Proj4js.common.PJD_7PARAM){s.geodetic_to_geocentric(p);if(s.datum_type==Proj4js.common.PJD_3PARAM||s.datum_type==Proj4js.common.PJD_7PARAM){s.geocentric_to_wgs84(p)}if(d.datum_type==Proj4js.common.PJD_3PARAM||d.datum_type==Proj4js.common.PJD_7PARAM){d.geocentric_from_wgs84(p)}d.geocentric_to_geodetic(p)}return p},adjust_axis:function(c,d,p){var x=p.x,y=p.y,z=p.z||0.0;var v,t;for(var i=0;i<3;i++){if(d&&i==2&&p.z===undefined){continue}if(i==0){v=x;t='x'}else if(i==1){v=y;t='y'}else{v=z;t='z'}switch(c.axis[i]){case'e':p[t]=v;break;case'w':p[t]=-v;break;case'n':p[t]=v;break;case's':p[t]=-v;break;case'u':if(p[t]!==undefined){p.z=v}break;case'd':if(p[t]!==undefined){p.z=-v}break;default:alert("ERROR: unknow axis ("+c.axis[i]+") - check definition of "+c.projName);return null}}return p},reportError:function(m){},extend:function(d,s){d=d||{};if(s){for(var p in s){var v=s[p];if(v!==undefined){d[p]=v}}}return d},Class:function(){var C=function(){this.initialize.apply(this,arguments)};var e={};var p;for(var i=0;i<arguments.length;++i){if(typeof arguments[i]=="function"){p=arguments[i].prototype}else{p=arguments[i]}Proj4js.extend(e,p)}C.prototype=e;return C},bind:function(f,o){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var n=a.concat(Array.prototype.slice.apply(arguments,[0]));return f.apply(o,n)}},scriptName:"proj4js.js",defsLookupService:'http://spatialreference.org/ref',libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;var s=this.scriptName;var a=s.length;var b=document.getElementsByTagName('script');for(var i=0;i<b.length;i++){var c=b[i].getAttribute('src');if(c){var d=c.lastIndexOf(s);if((d>-1)&&(d+a==c.length)){this.libPath=c.slice(0,-a);break}}}return this.libPath||""},loadScript:function(u,o,a,l){var s=document.createElement('script');s.defer=false;s.type="text/javascript";s.id=u;s.src=u;s.onload=o;s.onerror=a;s.loadCheck=l;if(/MSIE/.test(navigator.userAgent)){s.onreadystatechange=this.checkReadyState}document.getElementsByTagName('head')[0].appendChild(s)},checkReadyState:function(){if(this.readyState=='loaded'){if(!this.loadCheck()){this.onerror()}else{this.onload()}}}};Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:false,queue:null,initialize:function(s,c){this.srsCodeInput=s;this.queue=[];if(c){this.queue.push(c)}if((s.indexOf('GEOGCS')>=0)||(s.indexOf('GEOCCS')>=0)||(s.indexOf('PROJCS')>=0)||(s.indexOf('LOCAL_CS')>=0)){this.parseWKT(s);this.deriveConstants();this.loadProjCode(this.projName);return}if(s.indexOf('urn:')==0){var u=s.split(':');if((u[1]=='ogc'||u[1]=='x-ogc')&&(u[2]=='def')&&(u[3]=='crs')){s=u[4]+':'+u[u.length-1]}}else if(s.indexOf('http://')==0){var a=s.split('#');if(a[0].match(/epsg.org/)){s='EPSG:'+a[1]}else if(a[0].match(/RIG.xml/)){s='IGNF:'+a[1]}}this.srsCode=s.toUpperCase();if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;this.srsAuth='epsg';this.srsProjNumber=this.srsCode.substring(5)}else if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;this.srsAuth='IGNF';this.srsProjNumber=this.srsCode.substring(5)}else if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;this.srsAuth='CRS';this.srsProjNumber=this.srsCode.substring(4)}else{this.srsAuth='';this.srsProjNumber=this.srsCode}this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();return}var u=Proj4js.getScriptLocation()+'defs/'+this.srsAuth.toUpperCase()+this.srsProjNumber+'.js';Proj4js.loadScript(u,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var u=Proj4js.defsLookupService+'/'+this.srsAuth+'/'+this.srsProjNumber+'/proj4js/';Proj4js.loadScript(u,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName)},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true}else{return false}},defsFailed:function(){Proj4js.reportError('failed to load projection definition for: '+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs['WGS84'];this.defsLoaded()},loadProjCode:function(p){if(Proj4js.Proj[p]){this.initTransforms();return}var u=Proj4js.getScriptLocation()+'projCode/'+p+'.js';Proj4js.loadScript(u,Proj4js.bind(this.loadProjCodeSuccess,this,p),Proj4js.bind(this.loadProjCodeFailure,this,p),Proj4js.bind(this.checkCodeLoaded,this,p))},loadProjCodeSuccess:function(p){if(Proj4js.Proj[p].dependsOn){this.loadProjCode(Proj4js.Proj[p].dependsOn)}else{this.initTransforms()}},loadProjCodeFailure:function(p){Proj4js.reportError("failed to find projection file for: "+p)},checkCodeLoaded:function(p){if(Proj4js.Proj[p]){return true}else{return false}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=true;if(this.queue){var i;while((i=this.queue.shift())){i.call(this,this)}}},wktRE:/^(\w+)\[(.*)\]$/,parseWKT:function(w){var a=w.match(this.wktRE);if(!a)return;var b=a[1];var c=a[2];var d=c.split(",");var e;if(b.toUpperCase()=="TOWGS84"){e=b}else{e=d.shift()}e=e.replace(/^\"/,"");e=e.replace(/\"$/,"");var f=new Array();var g=0;var o="";for(var i=0;i<d.length;++i){var t=d[i];for(var j=0;j<t.length;++j){if(t.charAt(j)=="[")++g;if(t.charAt(j)=="]")--g}o+=t;if(g===0){f.push(o);o=""}else{o+=","}}switch(b){case'LOCAL_CS':this.projName='identity';this.localCS=true;this.srsCode=e;break;case'GEOGCS':this.projName='longlat';this.geocsCode=e;if(!this.srsCode)this.srsCode=e;break;case'PROJCS':this.srsCode=e;break;case'GEOCCS':break;case'PROJECTION':this.projName=Proj4js.wktProjections[e];break;case'DATUM':this.datumName=e;break;case'LOCAL_DATUM':this.datumCode='none';break;case'SPHEROID':this.ellps=e;this.a=parseFloat(f.shift());this.rf=parseFloat(f.shift());break;case'PRIMEM':this.from_greenwich=parseFloat(f.shift());break;case'UNIT':this.units=e;this.unitsPerMeter=parseFloat(f.shift());break;case'PARAMETER':var n=e.toLowerCase();var v=parseFloat(f.shift());switch(n){case'false_easting':this.x0=v;break;case'false_northing':this.y0=v;break;case'scale_factor':this.k0=v;break;case'central_meridian':this.long0=v*Proj4js.common.D2R;break;case'latitude_of_origin':this.lat0=v*Proj4js.common.D2R;break;case'more_here':break;default:break}break;case'TOWGS84':this.datum_params=f;break;case'AXIS':var n=e.toLowerCase();var v=f.shift();switch(v){case'EAST':v='e';break;case'WEST':v='w';break;case'NORTH':v='n';break;case'SOUTH':v='s';break;case'UP':v='u';break;case'DOWN':v='d';break;case'OTHER':default:v=' ';break}if(!this.axis){this.axis="enu"}switch(n){case'x':this.axis=v+this.axis.substr(1,2);break;case'y':this.axis=this.axis.substr(0,1)+v+this.axis.substr(2,1);break;case'z':this.axis=this.axis.substr(0,2)+v;break;default:break}case'MORE_HERE':break;default:break}for(var i=0;i<f.length;++i){this.parseWKT(f[i])}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var p,a;if(!this.defData){return}var b=this.defData.split("+");for(var c=0;c<b.length;c++){var d=b[c].split("=");p=d[0].toLowerCase();a=d[1];switch(p.replace(/\s/gi,"")){case"":break;case"title":this.title=a;break;case"proj":this.projName=a.replace(/\s/gi,"");break;case"units":this.units=a.replace(/\s/gi,"");break;case"datum":this.datumCode=a.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=a.replace(/\s/gi,"");break;case"ellps":this.ellps=a.replace(/\s/gi,"");break;case"a":this.a=parseFloat(a);break;case"b":this.b=parseFloat(a);break;case"rf":this.rf=parseFloat(a);break;case"lat_0":this.lat0=a*Proj4js.common.D2R;break;case"lat_1":this.lat1=a*Proj4js.common.D2R;break;case"lat_2":this.lat2=a*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=a*Proj4js.common.D2R;break;case"lon_0":this.long0=a*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(a)*Proj4js.common.D2R;break;case"lonc":this.longc=a*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(a);break;case"y_0":this.y0=parseFloat(a);break;case"k_0":this.k0=parseFloat(a);break;case"k":this.k0=parseFloat(a);break;case"r_a":this.R_A=true;break;case"zone":this.zone=parseInt(a,10);break;case"south":this.utmSouth=true;break;case"towgs84":this.datum_params=a.split(",");break;case"to_meter":this.to_meter=parseFloat(a);break;case"from_greenwich":this.from_greenwich=a*Proj4js.common.D2R;break;case"pm":a=a.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[a]?Proj4js.PrimeMeridian[a]:parseFloat(a);this.from_greenwich*=Proj4js.common.D2R;break;case"axis":a=a.replace(/\s/gi,"");var l="ewnsud";if(a.length==3&&l.indexOf(a.substr(0,1))!=-1&&l.indexOf(a.substr(1,1))!=-1&&l.indexOf(a.substr(2,1))!=-1){this.axis=a}break;case"no_defs":break;default:}}this.deriveConstants()},deriveConstants:function(){if(this.nagrids=='@null')this.datumCode='none';if(this.datumCode&&this.datumCode!='none'){var d=Proj4js.Datum[this.datumCode];if(d){this.datum_params=d.towgs84?d.towgs84.split(','):null;this.ellps=d.ellipse;this.datumName=d.datumName?d.datumName:this.datumCode}}if(!this.a){var e=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid['WGS84'];Proj4js.extend(this,e)}if(this.rf&&!this.b)this.b=(1.0-1.0/this.rf)*this.a;if(this.rf===0||Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;this.b=this.a}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1.-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0.}this.ep2=(this.a2-this.b2)/this.b2;if(!this.k0)this.k0=1.0;if(!this.axis){this.axis="enu"}this.datum=new Proj4js.datum(this)}});Proj4js.Proj.longlat={init:function(){},forward:function(p){return p},inverse:function(p){return p}};Proj4js.Proj.identity=Proj4js.Proj.longlat;Proj4js.defs={'WGS84':"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees",'EPSG:4326':"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees",'EPSG:4269':"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees",'EPSG:3875':"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs['EPSG:3785']=Proj4js.defs['EPSG:3875'];Proj4js.defs['GOOGLE']=Proj4js.defs['EPSG:3875'];Proj4js.defs['EPSG:900913']=Proj4js.defs['EPSG:3875'];Proj4js.defs['EPSG:102113']=Proj4js.defs['EPSG:3875'];Proj4js.common={PI:3.141592653589793238,HALF_PI:1.570796326794896619,TWO_PI:6.283185307179586477,FORTPI:0.78539816339744833,R2D:57.29577951308232088,D2R:0.01745329251994329577,SEC_TO_RAD:4.84813681109535993589914102357e-6,EPSLN:1.0e-10,MAX_ITER:20,COS_67P5:0.38268343236508977,AD_C:1.0026000,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137.0,SIXTH:.1666666666666666667,RA4:.04722222222222222222,RA6:.02215608465608465608,RV4:.06944444444444444444,RV6:.04243827160493827160,msfnz:function(e,s,c){var a=e*s;return c/(Math.sqrt(1.0-a*a))},tsfnz:function(e,p,s){var c=e*s;var a=.5*e;c=Math.pow(((1.0-c)/(1.0+c)),a);return(Math.tan(.5*(this.HALF_PI-p))/c)},phi2z:function(e,t){var a=.5*e;var c,d;var p=this.HALF_PI-2*Math.atan(t);for(var i=0;i<=15;i++){c=e*Math.sin(p);d=this.HALF_PI-2*Math.atan(t*(Math.pow(((1.0-c)/(1.0+c)),a)))-p;p+=d;if(Math.abs(d)<=.0000000001)return p}alert("phi2z has NoConvergence");return(-9999)},qsfnz:function(e,s){var c;if(e>1.0e-7){c=e*s;return((1.0-e*e)*(s/(1.0-c*c)-(.5/e)*Math.log((1.0-c)/(1.0+c))))}else{return(2.0*s)}},asinz:function(x){if(Math.abs(x)>1.0){x=(x>1.0)?1.0:-1.0}return Math.asin(x)},e0fn:function(x){return(1.0-0.25*x*(1.0+x/16.0*(3.0+1.25*x)))},e1fn:function(x){return(0.375*x*(1.0+0.25*x*(1.0+0.46875*x)))},e2fn:function(x){return(0.05859375*x*x*(1.0+0.75*x))},e3fn:function(x){return(x*x*x*(35.0/3072.0))},mlfn:function(e,a,b,c,p){return(e*p-a*Math.sin(2.0*p)+b*Math.sin(4.0*p)-c*Math.sin(6.0*p))},srat:function(e,a){return(Math.pow((1.0-e)/(1.0+e),a))},sign:function(x){if(x<0.0)return(-1);else return(1)},adjust_lon:function(x){x=(Math.abs(x)<this.PI)?x:(x-(this.sign(x)*this.TWO_PI));return x},adjust_lat:function(x){x=(Math.abs(x)<this.HALF_PI)?x:(x-(this.sign(x)*this.PI));return x},latiso:function(e,p,s){if(Math.abs(p)>this.HALF_PI)return+Number.NaN;if(p==this.HALF_PI)return Number.POSITIVE_INFINITY;if(p==-1.0*this.HALF_PI)return-1.0*Number.POSITIVE_INFINITY;var c=e*s;return Math.log(Math.tan((this.HALF_PI+p)/2.0))+e*Math.log((1.0-c)/(1.0+c))/2.0},fL:function(x,L){return 2.0*Math.atan(x*Math.exp(L))-this.HALF_PI},invlatiso:function(e,t){var p=this.fL(1.0,t);var I=0.0;var c=0.0;do{I=p;c=e*Math.sin(I);p=this.fL(Math.exp(e*Math.log((1.0+c)/(1.0-c))/2.0),t)}while(Math.abs(p-I)>1.0e-12);return p},sinh:function(x){var r=Math.exp(x);r=(r-1.0/r)/2.0;return r},cosh:function(x){var r=Math.exp(x);r=(r+1.0/r)/2.0;return r},tanh:function(x){var r=Math.exp(x);r=(r-1.0/r)/(r+1.0/r);return r},asinh:function(x){var s=(x>=0?1.0:-1.0);return s*(Math.log(Math.abs(x)+Math.sqrt(x*x+1.0)))},acosh:function(x){return 2.0*Math.log(Math.sqrt((x+1.0)/2.0)+Math.sqrt((x-1.0)/2.0))},atanh:function(x){return Math.log((x-1.0)/(x+1.0))/2.0},gN:function(a,e,s){var t=e*s;return a/Math.sqrt(1.0-t*t)},pj_enfn:function(e){var a=new Array();a[0]=this.C00-e*(this.C02+e*(this.C04+e*(this.C06+e*this.C08)));a[1]=e*(this.C22-e*(this.C04+e*(this.C06+e*this.C08)));var t=e*e;a[2]=t*(this.C44-e*(this.C46+e*this.C48));t*=e;a[3]=t*(this.C66-e*this.C68);a[4]=t*e*this.C88;return a},pj_mlfn:function(p,s,c,e){c*=s;s*=s;return(e[0]*p-c*(e[1]+s*(e[2]+s*(e[3]+s*e[4]))))},pj_inv_mlfn:function(a,e,b){var k=1./(1.-e);var p=a;for(var i=Proj4js.common.MAX_ITER;i;--i){var s=Math.sin(p);var t=1.-e*s*s;t=(this.pj_mlfn(p,s,Math.cos(p),b)-a)*(t*Math.sqrt(t))*k;p-=t;if(Math.abs(t)<Proj4js.common.EPSLN)return p}Proj4js.reportError("cass:pj_inv_mlfn: Convergence error");return p},C00:1.0,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.01302083333333333333,C48:.00712076822916666666,C66:.36458333333333333333,C68:.00569661458333333333,C88:.3076171875};Proj4js.datum=Proj4js.Class({initialize:function(p){this.datum_type=Proj4js.common.PJD_WGS84;if(p.datumCode&&p.datumCode=='none'){this.datum_type=Proj4js.common.PJD_NODATUM}if(p&&p.datum_params){for(var i=0;i<p.datum_params.length;i++){p.datum_params[i]=parseFloat(p.datum_params[i])}if(p.datum_params[0]!=0||p.datum_params[1]!=0||p.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM}if(p.datum_params.length>3){if(p.datum_params[3]!=0||p.datum_params[4]!=0||p.datum_params[5]!=0||p.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;p.datum_params[3]*=Proj4js.common.SEC_TO_RAD;p.datum_params[4]*=Proj4js.common.SEC_TO_RAD;p.datum_params[5]*=Proj4js.common.SEC_TO_RAD;p.datum_params[6]=(p.datum_params[6]/1000000.0)+1.0}}}if(p){this.a=p.a;this.b=p.b;this.es=p.es;this.ep2=p.ep2;this.datum_params=p.datum_params}},compare_datums:function(d){if(this.datum_type!=d.datum_type){return false}else if(this.a!=d.a||Math.abs(this.es-d.es)>0.000000000050){return false}else if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==d.datum_params[0]&&this.datum_params[1]==d.datum_params[1]&&this.datum_params[2]==d.datum_params[2])}else if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==d.datum_params[0]&&this.datum_params[1]==d.datum_params[1]&&this.datum_params[2]==d.datum_params[2]&&this.datum_params[3]==d.datum_params[3]&&this.datum_params[4]==d.datum_params[4]&&this.datum_params[5]==d.datum_params[5]&&this.datum_params[6]==d.datum_params[6])}else if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT||d.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented.");return false}else{return true}},geodetic_to_geocentric:function(p){var L=p.x;var a=p.y;var H=p.z?p.z:0;var X;var Y;var Z;var E=0;var R;var S;var b;var C;if(a<-Proj4js.common.HALF_PI&&a>-1.001*Proj4js.common.HALF_PI){a=-Proj4js.common.HALF_PI}else if(a>Proj4js.common.HALF_PI&&a<1.001*Proj4js.common.HALF_PI){a=Proj4js.common.HALF_PI}else if((a<-Proj4js.common.HALF_PI)||(a>Proj4js.common.HALF_PI)){Proj4js.reportError('geocent:lat out of range:'+a);return null}if(L>Proj4js.common.PI)L-=(2*Proj4js.common.PI);S=Math.sin(a);C=Math.cos(a);b=S*S;R=this.a/(Math.sqrt(1.0e0-this.es*b));X=(R+H)*C*Math.cos(L);Y=(R+H)*C*Math.sin(L);Z=((R*(1-this.es))+H)*S;p.x=X;p.y=Y;p.z=Z;return E},geocentric_to_geodetic:function(p){var g=1.E-12;var a=(g*g);var m=30;var P;var R;var C;var S;var b;var c;var d;var e;var f;var h;var i;var j;var A;var k;var X=p.x;var Y=p.y;var Z=p.z?p.z:0.0;var L;var l;var H;A=false;P=Math.sqrt(X*X+Y*Y);R=Math.sqrt(X*X+Y*Y+Z*Z);if(P/this.a<g){A=true;L=0.0;if(R/this.a<g){l=Proj4js.common.HALF_PI;H=-this.b;return}}else{L=Math.atan2(Y,X)}C=Z/R;S=P/R;b=1.0/Math.sqrt(1.0-this.es*(2.0-this.es)*S*S);e=S*(1.0-this.es)*b;f=C*b;k=0;do{k++;d=this.a/Math.sqrt(1.0-this.es*f*f);H=P*e+Z*f-d*(1.0-this.es*f*f);c=this.es*d/(d+H);b=1.0/Math.sqrt(1.0-c*(2.0-c)*S*S);h=S*(1.0-c)*b;i=C*b;j=i*e-h*f;e=h;f=i}while(j*j>a&&k<m);l=Math.atan(i/Math.abs(h));p.x=L;p.y=l;p.z=H;return p},geocentric_to_geodetic_noniter:function(p){var X=p.x;var Y=p.y;var Z=p.z?p.z:0;var L;var a;var H;var W;var b;var T;var c;var S;var d;var e;var f;var C;var g;var h;var R;var i;var A;X=parseFloat(X);Y=parseFloat(Y);Z=parseFloat(Z);A=false;if(X!=0.0){L=Math.atan2(Y,X)}else{if(Y>0){L=Proj4js.common.HALF_PI}else if(Y<0){L=-Proj4js.common.HALF_PI}else{A=true;L=0.0;if(Z>0.0){a=Proj4js.common.HALF_PI}else if(Z<0.0){a=-Proj4js.common.HALF_PI}else{a=Proj4js.common.HALF_PI;H=-this.b;return}}}b=X*X+Y*Y;W=Math.sqrt(b);T=Z*Proj4js.common.AD_C;S=Math.sqrt(T*T+b);e=T/S;C=W/S;f=e*e*e;c=Z+this.b*this.ep2*f;i=W-this.a*this.es*C*C*C;d=Math.sqrt(c*c+i*i);g=c/d;h=i/d;R=this.a/Math.sqrt(1.0-this.es*g*g);if(h>=Proj4js.common.COS_67P5){H=W/h-R}else if(h<=-Proj4js.common.COS_67P5){H=W/-h-R}else{H=Z/g+R*(this.es-1.0)}if(A==false){a=Math.atan(g/h)}p.x=L;p.y=a;p.z=H;return p},geocentric_to_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM){p.x+=this.datum_params[0];p.y+=this.datum_params[1];p.z+=this.datum_params[2]}else if(this.datum_type==Proj4js.common.PJD_7PARAM){var D=this.datum_params[0];var a=this.datum_params[1];var b=this.datum_params[2];var R=this.datum_params[3];var c=this.datum_params[4];var d=this.datum_params[5];var M=this.datum_params[6];var x=M*(p.x-d*p.y+c*p.z)+D;var y=M*(d*p.x+p.y-R*p.z)+a;var z=M*(-c*p.x+R*p.y+p.z)+b;p.x=x;p.y=y;p.z=z}},geocentric_from_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM){p.x-=this.datum_params[0];p.y-=this.datum_params[1];p.z-=this.datum_params[2]}else if(this.datum_type==Proj4js.common.PJD_7PARAM){var D=this.datum_params[0];var a=this.datum_params[1];var b=this.datum_params[2];var R=this.datum_params[3];var c=this.datum_params[4];var d=this.datum_params[5];var M=this.datum_params[6];var x=(p.x-D)/M;var y=(p.y-a)/M;var z=(p.z-b)/M;p.x=x+d*y-c*z;p.y=-d*x+y+R*z;p.z=c*x-R*y+z}}});Proj4js.Point=Proj4js.Class({initialize:function(x,y,z){if(typeof x=='object'){this.x=x[0];this.y=x[1];this.z=x[2]||0.0}else if(typeof x=='string'&&typeof y=='undefined'){var c=x.split(',');this.x=parseFloat(c[0]);this.y=parseFloat(c[1]);this.z=parseFloat(c[2])||0.0}else{this.x=x;this.y=y;this.z=z||0.0}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return("x="+this.x+",y="+this.y)},toShortString:function(){return(this.x+", "+this.y)}});Proj4js.PrimeMeridian={"greenwich":0.0,"lisbon":-9.131906111111,"paris":2.337229166667,"bogota":-74.080916666667,"madrid":-3.687938888889,"rome":12.452333333333,"bern":7.439583333333,"jakarta":106.807719444444,"ferro":-17.666666666667,"brussels":4.367975,"stockholm":18.058277777778,"athens":23.7163375,"oslo":10.722916666667};Proj4js.Ellipsoid={"MERIT":{a:6378137.0,rf:298.257,ellipseName:"MERIT 1983"},"SGS85":{a:6378136.0,rf:298.257,ellipseName:"Soviet Geodetic System 85"},"GRS80":{a:6378137.0,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},"IAU76":{a:6378140.0,rf:298.257,ellipseName:"IAU 1976"},"airy":{a:6377563.396,b:6356256.910,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},"NWL9D":{a:6378145.0,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},"mod_airy":{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},"andrae":{a:6377104.43,rf:300.0,ellipseName:"Andrae 1876 (Den., Iclnd.)"},"aust_SA":{a:6378160.0,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},"GRS67":{a:6378160.0,rf:298.2471674270,ellipseName:"GRS 67(IUGG 1967)"},"bessel":{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},"bess_nam":{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},"clrk66":{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},"clrk80":{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},"CPM":{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},"delmbr":{a:6376428.0,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},"engelis":{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},"evrst30":{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},"evrst48":{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},"evrst56":{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},"evrst69":{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},"evrstSS":{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},"fschr60":{a:6378166.0,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},"fschr60m":{a:6378155.0,rf:298.3,ellipseName:"Fischer 1960"},"fschr68":{a:6378150.0,rf:298.3,ellipseName:"Fischer 1968"},"helmert":{a:6378200.0,rf:298.3,ellipseName:"Helmert 1906"},"hough":{a:6378270.0,rf:297.0,ellipseName:"Hough"},"intl":{a:6378388.0,rf:297.0,ellipseName:"International 1909 (Hayford)"},"kaula":{a:6378163.0,rf:298.24,ellipseName:"Kaula 1961"},"lerch":{a:6378139.0,rf:298.257,ellipseName:"Lerch 1979"},"mprts":{a:6397300.0,rf:191.0,ellipseName:"Maupertius 1738"},"new_intl":{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},"plessis":{a:6376523.0,rf:6355863.0,ellipseName:"Plessis 1817 (France)"},"krass":{a:6378245.0,rf:298.3,ellipseName:"Krassovsky, 1942"},"SEasia":{a:6378155.0,b:6356773.3205,ellipseName:"Southeast Asia"},"walbeck":{a:6376896.0,b:6355834.8467,ellipseName:"Walbeck"},"WGS60":{a:6378165.0,rf:298.3,ellipseName:"WGS 60"},"WGS66":{a:6378145.0,rf:298.25,ellipseName:"WGS 66"},"WGS72":{a:6378135.0,rf:298.26,ellipseName:"WGS 72"},"WGS84":{a:6378137.0,rf:298.257223563,ellipseName:"WGS 84"},"sphere":{a:6370997.0,b:6370997.0,ellipseName:"Normal Sphere (r=6370997)"}};Proj4js.Datum={"WGS84":{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},"GGRS87":{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},"NAD83":{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},"NAD27":{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},"potsdam":{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},"carthage":{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},"hermannskogel":{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},"ire65":{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},"nzgd49":{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},"OSGB36":{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj('WGS84');Proj4js.Datum['OSB36']=Proj4js.Datum['OSGB36'];Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc","Mercator":"merc","Popular Visualisation Pseudo Mercator":"merc","Mercator_1SP":"merc","Transverse_Mercator":"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"};
