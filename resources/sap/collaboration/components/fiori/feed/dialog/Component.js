/*!
 * @copyright@
 */
jQuery.sap.require("sap.collaboration.library");jQuery.sap.require("sap.collaboration.components.utils.CommonUtil");jQuery.sap.require("sap.collaboration.components.utils.JamUtil");jQuery.sap.require("sap.collaboration.components.utils.OdataUtil");jQuery.sap.require("sap.ui.core.UIComponent");jQuery.sap.declare("sap.collaboration.components.fiori.feed.dialog.Component");sap.ui.core.UIComponent.extend("sap.collaboration.components.fiori.feed.dialog.Component",{metadata:{includes:["../../../css/Sharing.css"],properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"575px"},height:{type:"sap.ui.core.CSSSize",defaultValue:"605px"},oDataServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/opu/odata/sap/SM_INTEGRATION_SRV"},feedType:{type:"string",defaultValue:sap.collaboration.FeedType.object},groupIds:{type:"string"},object:{type:"object"}},aggregations:{},events:{}},init:function(){this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oLangBundle=this.oCommonUtil.getLanguageBundle();sap.ui.core.UIComponent.prototype.init.apply(this)},setSettings:function(s){this.setODataServiceUrl(s.oDataServiceUrl);this.setFeedType(s.feedType);this.setGroupIds(s.groupIds);this.setObject(s.object)},onBeforeRendering:function(){},onAfterRendering:function(){},render:function(r){},initOdata:function(){var a=true;var o=this.getODataServiceUrl();this.oOdataModel=new sap.ui.model.odata.ODataModel(o,a);if(!this.oOdataModel.oMetadata.oMetadata){var e=new Error("Metadata is undefined");jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.dialog.Component.initOdata()");throw e}var O=new sap.collaboration.components.utils.OdataUtil();try{this.sJamUrl=O.getJamUrl(this.oOdataModel);this.sJamToken=O.getJamToken(this.oOdataModel)}catch(E){jQuery.sap.log.error(E,"","sap.collaboration.components.fiori.feed.dialog.Component.initOdata()");throw E}},createFeedDialogComponent:function(){try{this.initOdata();this.createFeedView();this.createFeedDialog()}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.dialog.Component.createFeedDialogComponent()");throw e}},createFeedView:function(){try{if(!this.oFeedView){this.oFeedView=sap.ui.view({id:this.getId()+"_FeedView",height:"100%",viewData:{controlId:this.getId(),jamURL:this.sJamUrl,jamToken:this.sJamToken,appType:sap.collaboration.AppType.widget,feedType:this.getFeedType(),groupIds:this.getGroupIds(),object:this.getObject(),langBundle:this.oLangBundle},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.feed.commons.Detail"})}else{this.oFeedView.getController().sFeedType=this.getFeedType();this.oFeedView.getViewData().groupIds=this.getGroupIds();this.oFeedView.getController().oBusinessObject=this.getObject()}}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.dialog.Component.createFeedView()");throw e}},createFeedDialog:function(){var s=this;if(!this.oFeedDialog){this.oFeedDialog=new sap.m.Dialog(this.getId()+"FeedDialog",{title:this.oLangBundle.getText("FEED_DIALOG_TITLE"),stretch:false,contentWidth:this.getWidth(),contentHeight:this.getHeight(),content:[this.oFeedView],endButton:new sap.m.Button({text:this.oLangBundle.getText("CLOSE_BUTTON_TEXT"),press:function(){s.oFeedDialog.close()}})});if(jQuery.device.is.phone){this.oFeedDialog.setStretch(true)}}},open:function(){jQuery.sap.log.debug("Feed Dialog Component properties:","","sap.collaboration.components.fiori.feed.dialog.Component.open()");jQuery.sap.log.debug("width: "+this.getWidth());jQuery.sap.log.debug("height: "+this.getHeight());jQuery.sap.log.debug("oDataServiceUrl: "+this.getODataServiceUrl());jQuery.sap.log.debug("feedType: "+this.getFeedType());jQuery.sap.log.debug("groupIds: "+this.getGroupIds());jQuery.sap.log.debug("object: "+JSON.stringify(this.getObject()));try{this.createFeedDialogComponent();this.oFeedDialog.open()}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.dialog.Component.open()");this.oCommonUtil.displayError(e)}}});
