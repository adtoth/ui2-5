/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright
 * 		2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.FileUpload");jQuery.sap.require("sap.ca.ui.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.ca.ui.FileUpload",{metadata:{publicMethods:["removeFile","abandonPendingRenames","commitPendingRenames","commitFileUpload","setCustomHeader","removeCustomHeader","preventEdits"],library:"sap.ca.ui",properties:{"uploadUrl":{type:"string",group:"Misc",defaultValue:null},"fileName":{type:"string",group:"Misc",defaultValue:null},"size":{type:"string",group:"Misc",defaultValue:null},"url":{type:"string",group:"Misc",defaultValue:null},"uploadedDate":{type:"string",group:"Misc",defaultValue:null},"contributor":{type:"string",group:"Misc",defaultValue:null},"fileExtension":{type:"string",group:"Misc",defaultValue:null},"mimeType":{type:"string",group:"Misc",defaultValue:null},"items":{type:"string",group:"Misc",defaultValue:null},"uploadEnabled":{type:"boolean",group:"Misc",defaultValue:null},"editMode":{type:"boolean",group:"Misc",defaultValue:false},"fileId":{type:"string",group:"Misc",defaultValue:null},"xsrfToken":{type:"string",group:"Misc",defaultValue:null},"useMultipart":{type:"boolean",group:"Misc",defaultValue:false},"acceptRequestHeader":{type:"string",group:"Misc",defaultValue:'application/json'},"encodeUrl":{type:"string",group:"Misc",defaultValue:null},"renameEnabled":{type:"boolean",group:"Misc",defaultValue:null},"showNoData":{type:"boolean",group:"Misc",defaultValue:false},"showAttachmentsLabelInEditMode":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"fileList":{type:"sap.m.List",multiple:false,visibility:"hidden"},"oProgressText":{type:"sap.m.Text",multiple:false,visibility:"hidden"},"uploadProgressLabel":{type:"sap.m.Label",multiple:false},"attachmentNumberLabel":{type:"sap.m.Label",multiple:false}},events:{"deleteFile":{},"renameFile":{},"uploadFile":{},"fileUploadFailed":{},"beforeUploadFile":{}}}});sap.ca.ui.FileUpload.M_EVENTS={'deleteFile':'deleteFile','renameFile':'renameFile','uploadFile':'uploadFile','fileUploadFailed':'fileUploadFailed','beforeUploadFile':'beforeUploadFile'};jQuery.sap.declare("sap.ca.ui.FileUpload");jQuery.sap.require("sap.ca.ui.utils.resourcebundle");jQuery.sap.require("sap.ca.ui.dialog.factory");jQuery.sap.require("sap.ca.ui.model.format.FileSizeFormat");jQuery.sap.require("sap.ca.ui.model.type.Date");var Formatter=sap.ca.ui.model.format.FileSizeFormat.getInstance();
sap.ca.ui.FileUpload.prototype.init=function(){this._oCustomHeaderArray=[];this._sUsrAg=navigator.userAgent;this._oBundle=sap.ca.ui.utils.resourcebundle;this._sUploadText=this._oBundle.getText("FileUploader.upload");this._sOverallUploadingText=this._oBundle.getText("FileUploader.uploadingOutOf",["{filesUploaded} "," {filesToUpload}"]);this._sUploadingText=this._oBundle.getText("FileUploader.uploading");this._sComplete=this._oBundle.getText("FileUploader.complete");this._sOutOf=this._oBundle.getText("FileUploader.outOf");this._sDeleteFile=this._oBundle.getText("FileUploader.deleteFile");this._sContinue=this._oBundle.getText("FileUploader.continue");this._sDeleteQuestion=this._oBundle.getText("FileUploader.deleteQuestion");var c=this;this._oProgressLabel=new sap.m.Label(this.getId()+"-progress",{text:{path:"uploadPercent",formatter:function(v){var b=this.getBindingContext().getPath();var p=b+"/uploadPercent";var e=this.getModel().getProperty(p);var V=c._sUploadingText+": "+e+"% "+c._sComplete;return V}},visible:{path:"isUploading",formatter:function(v){if(c._isIE()){return false}return v}}});this._oNumberOfAttachmentsLabel=new sap.m.Label(this.getId()+"-attachmentLabel",{design:sap.m.LabelDesign.Standard}).addStyleClass("sapCaUiFileUploadAttachmentLabel");this._oFileSizeLabel=new sap.m.Label(this.getId()+"-fileSizeLabel").addStyleClass("sapCaUiFileUploadFileSizeText");this._oUploadedDateLabel=new sap.m.Label(this.getId()+"-uploadedDate",{visible:"{isUploaded}"});this._oUploadingProgressLabel=new sap.m.Label(this.getId()+"-uploadProgressLabel",{design:sap.m.LabelDesign.Bold,text:c._sOverallUploadingText}).addStyleClass("sapCaUiFileUploadProgressLabel");this._oFileExtensionLabel=new sap.m.Label(this.getId()+"-extension",{text:"{parsedFileExtension}"}).addStyleClass('sapCaUiFUExtension');this._oFileNameLabel=new sap.m.Link(this.getId()+"-filename",{target:"_blank"}).addStyleClass('sapCaUiFileUploadFileLoadedText');this._oFileNameEditBox=new sap.m.Input(this.getId()+"-editFileName",{type:sap.m.Input.Text}).addStyleClass('sapCaUiFileUploadEditBox');this._oFileNameEditBox.attachChange(this,this._nameChanged);var d=new sap.ui.layout.HorizontalLayout(this.getId()+"-ba-datesizelayout",{content:[this._oUploadedDateLabel,this._oFileSizeLabel,this._oProgressLabel],allowWrapping:true}).addStyleClass('sapCaUiFUInnerHL');this._oInputExtensionHL=new sap.ui.layout.HorizontalLayout({content:[this._oFileNameEditBox,this._oFileExtensionLabel],allowWrapping:true}).addStyleClass("sapCaUiInnerEditHL");var i=new sap.ui.layout.VerticalLayout(this.getId()+"-ba-inner",{content:[this._oFileNameLabel,this._oInputExtensionHL,d]}).addStyleClass('sapCaUiFUInner');this._oItemIcon=new sap.ui.core.Icon(this.getId()+"-icon",{visible:"{isUploaded}"}).setWidth('2.5rem').setHeight('2.5rem').addStyleClass("sapCaUiFileUploadItemIcon");var _=sap.ui.core.IconPool.createControlByURI({id:this.getId()+"-deleteIcon",src:sap.ui.core.IconPool.getIconURI("sys-cancel"),press:jQuery.proxy(this._handleDelete,this),visible:"{isDeleteVisible}",enabled:"{isEditEnabled}"}).addStyleClass("sapCaUiFileUploadDeleteIcon");var a=sap.ui.core.IconPool.createControlByURI({id:this.getId()+"-cancelIcon",src:sap.ui.core.IconPool.getIconURI("sys-cancel-2"),visible:"{isUploading}",press:jQuery.proxy(function(e){var c=e.getSource();var p=c.getBindingContext().getPath();var A=c.getModel().getProperty(p+"/abortUpl");A();var t=p.split('/');var n=t[t.length-1];var I=c.getModel().getProperty(this.getItems());I.splice(n,1);c.getModel().setProperty(this.getItems(),I);c.getModel().setProperty(this.getItems()+"/filesToUpload",c.getModel().getProperty(this.getItems()+"/filesToUpload")-1);this._maintainUploadingProgress()},this)}).addStyleClass("sapCaUiFileUploadCancelIcon");var h=new sap.ui.layout.HorizontalLayout(this.getId()+"-ba-hl",{content:[new sap.m.BusyIndicator({id:this.getId()+"-indicator",visible:"{isUploading}"}).setSize('2.5rem').addStyleClass('sapCaUiFileUploadloadingIcon'),this._oItemIcon,i,_,a],allowWrapping:true}).addStyleClass("sapCaUiFUItemHL");this._oViewPageList=new sap.m.List();this._oViewPageList.addStyleClass("sapCaFileUploadListBorder");this._oTemplate=new sap.m.CustomListItem({content:[h]});this.setAggregation("attachmentNumberLabel",this._oNumberOfAttachmentsLabel);this.setAggregation("fileList",this._oViewPageList);this.setAggregation("uploadProgressLabel",this._oUploadingProgressLabel)};
sap.ca.ui.FileUpload.prototype.onAfterRendering=function(){var u=this.getUploadUrl();this._oViewPageList.setShowNoData(this.getShowNoData());var i=this.getId();i=i.replace(/[#;&,.+*~':"!^$[\]()=>|\/]/g,"\\$&");i='#'+i+'-upload';if(this._isIE()&&!this.getUseMultipart()){u=this.getEncodeUrl()}jQuery(i).fileupload({multipart:this.getUseMultipart(),url:u,add:jQuery.proxy(function(e,d){this.onAdd(e,d)},this),send:jQuery.proxy(function(e,d){this.sending(e,d)},this),progress:jQuery.proxy(function(e,d){this.calculateProgress(e,d)},this),done:jQuery.proxy(function(e,d){this.uploadDone(e,d)},this),fail:jQuery.proxy(function(e,d){this.handleUploadFailure(e,d)},this),beforeSend:jQuery.proxy(function(x,d){this.fireBeforeUploadFile(d.files[0]);this._setRequestHeaders(x)},this)})};
sap.ca.ui.FileUpload.prototype.exit=function(){this._oViewPageList.destroy();this._oViewPageList=null;this._oTemplate.destroy();this._oTemplate=null;this._oFileNameLabel.destroy();this._oFileNameLabel=null;this._oUploadedDateLabel.destroy();this._oUploadedDateLabel=null;this._oProgressLabel.destroy();this._oProgressLabel=null;if(this._oInputExtensionHL){this._oInputExtensionHL.destroy();this._oInputExtensionHL=null}};
sap.ca.ui.FileUpload.prototype.preventEdits=function(l){var a=this.getItems();this.getModel().setProperty(a+"/isEditEnabled",!l)};
sap.ca.ui.FileUpload.prototype.removeFile=function(f){if((f instanceof Array)&&f.length>0){f=f[0]}var n=[];var I=this.getModel().getProperty(this.getItems());for(var i=0;i<I.length;i++){if(I[i][this.getFileId()]!==f){n.push(I[i])}}n.isUploading=I.isUploading;n.filesToUpload=I.filesToUpload;n.filesUploaded=I.filesUploaded;n.isEditMode=I.isEditMode;this.getModel().setProperty(this.getItems(),n);this.commitPendingRenames()};
sap.ca.ui.FileUpload.prototype.setModel=function(m){sap.ui.core.Control.prototype.setModel.call(this,m);jQuery.each(this.getModel().getProperty(this.getItems()),jQuery.proxy(function(a,v){this.getModel().setProperty(this.getItems()+"/"+a+"/isUploaded",true);this.getModel().setProperty(this.getItems()+"/"+a+"/isUploading",false);this.getModel().setProperty(this.getItems()+"/"+a+"/isPending",false);this.getModel().setProperty(this.getItems()+"/"+a+"/isDeleteVisible",false);this.getModel().setProperty(this.getItems()+"/"+a+"/isPendingFileRename",false);this.getModel().setProperty(this.getItems()+"/"+a+"/isFileNameSwapped",false);this.getModel().setProperty(this.getItems()+"/"+a+"/isHiddenFile",false);var p=this.getModel().getProperty(this.getItems()+"/"+a+"/"+this.getFileName()).split(".");if(p.length===1){p=""}else if(p[0]===""&&p.length===2){this.getModel().setProperty(this.getItems()+"/"+a+"/isHiddenFile",true);p=""}else{p="."+p.pop()}this.getModel().setProperty(this.getItems()+"/"+a+"/parsedFileExtension",p);var b=this.getModel().bindProperty(this.getItems()+"/"+a+"/isUploaded");b.attachChange(this.getItems(),this._isUploadedChange)},this));this.getModel().setProperty(this.getItems()+"/isUploading",false);this.getModel().setProperty(this.getItems()+"/filesToUpload",0);this.getModel().setProperty(this.getItems()+"/filesUploaded",1);this.getModel().setProperty(this.getItems()+"/isEditEnabled",true);this.getModel().setProperty(this.getItems()+"/isRenameEnabled",this.getRenameEnabled());var i=this.getModel().bindProperty(this.getItems()+"/isEditMode");i.attachChange(this.getItems(),this._isEditChange);this.getModel().setProperty(this.getItems()+"/isEditMode",this.getEditMode());this._oNumberOfAttachmentsLabel.bindProperty("text",this.getProperty("items")+"/length",function(l){var L=sap.ca.ui.utils.resourcebundle.getText("FileUploader.attachments")+" ("+l+")";return L});this._oFileSizeLabel.bindProperty("visible",{parts:[{path:this.getItems()+"/isEditMode"},{path:"isUploaded"}],formatter:jQuery.proxy(function(e,I){if(this._isIE()){return e&&I}return e},this)});if(this.getShowAttachmentsLabelInEditMode()){this._oNumberOfAttachmentsLabel.bindProperty("visible",this.getProperty("items")+"/isEditMode")}else{this._oNumberOfAttachmentsLabel.setVisible(false)}this._oUploadingProgressLabel.bindProperty("visible",this.getProperty("items")+'/isUploading');this._oUploadingProgressLabel.bindElement(this.getProperty("items"));this._oNumberOfAttachmentsLabel.bindElement(this.getProperty("items"));this._oViewPageList.bindItems(this.getProperty("items"),this._oTemplate,null,null)};
sap.ca.ui.FileUpload.prototype.setCustomHeader=function(h,v){if(this._oCustomHeaderArray===[]){this._oCusomHeaderArray.push({key:h,value:v})}else{var n=this._oCustomHeaderArray.length;for(var i=0;i<n;i++){if(this._oCustomHeaderArray[i].key===h){this._oCustomHeaderArray[i].value=v;return}}this._oCustomHeaderArray.push({key:h,value:v})}};
sap.ca.ui.FileUpload.prototype.removeCustomHeader=function(h){var n=-1;for(var i=0;i<this._oCustomHeaderArray.length;i++){if(this._oCustomHeaderArray[i].key===h){n=i}}if(n!==-1){this._oCustomHeaderArray.splice(n,1)}};
sap.ca.ui.FileUpload.prototype.commitFileUpload=function(d){var u=d[this.getFileName()];d.size=Formatter.format(d.size);var a=this.getModel().getProperty(this.getItems()+"/").length;for(var i=0;i<a;i++){var p=this.getItems()+"/"+i;if(this.getModel().getProperty(p+"/"+this.getFileName())===u&&this.getModel().getProperty(p+"/isUploading")){this.getModel().setProperty(p+"/"+this.getFileId(),d[this.getFileId()]);this.getModel().setProperty(p+"/"+this.getFileExtension(),d[this.getFileExtension()]);this.getModel().setProperty(p+"/"+this.getMimeType(),d[this.getMimeType()]);this.getModel().setProperty(p+"/"+this.getContributor(),d[this.getContributor()]);this.getModel().setProperty(p+"/"+this.getUploadedDate(),d[this.getUploadedDate()]);this.getModel().setProperty(p+"/"+this.getFileName(),d[this.getFileName()]);this.getModel().setProperty(p+"/"+this.getUrl(),d[this.getUrl()]);this.getModel().setProperty(p+"/"+this.getFileId(),d[this.getFileId()]);this.getModel().setProperty(p+"/"+this.getSize(),d[this.getSize()]);this.getModel().setProperty(p+"/isHiddenFile",false);var P=u.split(".");if(P.length===1){P=""}else if(P[0]===""&&P.length===2){P="";this.getModel().setProperty(p+"/isHiddenFile",true)}else{P="."+P.pop()}this.getModel().setProperty(p+"/parsedFileExtension",P);this.getModel().setProperty(p+"/isPending",false);this.getModel().setProperty(p+"/isUploading",false);this.getModel().setProperty(p+"/isUploaded",true);this.getModel().setProperty(p+"/abortUpl",undefined);this.getModel().setProperty(this.getItems()+"/filesUploaded",this.getModel().getProperty(this.getItems()+"/filesUploaded")+1);this._maintainUploadingProgress()}}};
sap.ca.ui.FileUpload.prototype.commitPendingRenames=function(){var l=this.getItems();var I=this.getModel().getProperty(l);for(var i=0;i<I.length;i++){if(I[i].newFilename!==undefined&&I[i][this.getFileName()]!==I[i].newFilename){var f=I[i]["isHiddenFile"];var n="";if(I[i].isPendingFileRename){if(f){n="."+I[i].newFilename}else{n=I[i].newFilename+I[i]["parsedFileExtension"]}}else if(I[i].isFileNameSwapped){if(f){n="."+I[i][this.getFileName()]}else{n=I[i][this.getFileName()]+I[i]["parsedFileExtension"]}}this.getModel().setProperty(l+"/"+i+"/"+this.getFileName(),n);this.getModel().setProperty(l+"/"+i+"/newFilename",undefined)}I[i].isPendingFileRename=false;I[i].isFileNameSwapped=false}};
sap.ca.ui.FileUpload.prototype.abandonPendingRenames=function(){var l=this.getItems();var I=this.getModel().getProperty(l);for(var i=0;i<I.length;i++){if(I[i].isFileNameSwapped){I[i][this.getFileName()]=I[i].newFilename}I[i].isPendingFileRename=false;I[i].isFileNameSwapped=false}this.getModel().refresh(true)};
sap.ca.ui.FileUpload.prototype._setUploadedDateBinding=function(d,c,s){var D=(d===null)?this.getUploadedDate():d;var a="{path: '"+D+"', type:'sap.ca.ui.model.type.Date', formatOptions : { style:'medium'}}";var C=(c===null)?this.getContributor():c;s=(s===null)?this.getSize():s;var A;if(this._isPhone()){A=this._oBundle.getText("FileUploader.attached_phone",[a,"{"+C+"}"])}else{A=this._oBundle.getText("FileUploader.attached",[a,"{"+C+"}"])}this._oUploadedDateLabel.setText(A);this._oFileSizeLabel.setText(" ({"+s+"})")};
sap.ca.ui.FileUpload.prototype.setItems=function(v){var o=this.getItems();if(o!==v){this._oFileNameLabel.bindProperty("visible",{parts:[{path:v+"/isEditMode"},{path:"isUploading"}],formatter:function(e,u){return!e||u}});this._oInputExtensionHL.bindProperty("visible",{parts:[{path:v+"/isEditMode"},{path:"isUploading"}],formatter:function(e,u){return e&&!u}});this._oFileNameEditBox.bindProperty("enabled",{parts:[{path:v+"/isEditEnabled"},{path:v+"/isRenameEnabled"}],formatter:function(e,r){return e&&r}});this.setProperty("items",v)}};
sap.ca.ui.FileUpload.prototype.setFileName=function(v){var o=this.getFileName();if(o!==v){this._oFileNameLabel.bindProperty("text",v);this._oFileNameEditBox.bindValue(v,function(V){var O=V.substr(0,V.lastIndexOf('.'))||V;return O},sap.ui.model.BindingMode.OneWay);this.setProperty("fileName",v)}};
sap.ca.ui.FileUpload.prototype.setEditMode=function(v){var o=this.getEditMode();if(o!==v){if(this.getModel()){this.getModel().setProperty(this.getItems()+"/isEditMode",v);this.getModel().refresh(true)}this.setProperty("editMode",v)}if(this.getModel()&&v===false){this.getModel().setProperty(this.getItems()+"/isEditEnabled",true)}};
sap.ca.ui.FileUpload.prototype.setContributor=function(v){var o=this.getContributor();if(o!==v){this._setUploadedDateBinding(null,v,null);this.setProperty("contributor",v)}};
sap.ca.ui.FileUpload.prototype.setUploadedDate=function(v){var o=this.getUploadedDate();if(o!==v){this._setUploadedDateBinding(v,null,null);this.setProperty("uploadedDate",v)}};
sap.ca.ui.FileUpload.prototype.setSize=function(v){var s=this.getSize();if(s!==v){this._setUploadedDateBinding(null,null,v);this.setProperty("size",v)}};
sap.ca.ui.FileUpload.prototype.setUrl=function(v){var o=this.getUrl();if(o!==v){this._oFileNameLabel.bindProperty("href",{path:v,formatter:this._removeStartingSlash});this.setProperty("url",v)}};
sap.ca.ui.FileUpload.prototype.setMimeType=function(v){var o=this.getMimeType();if(o!==v){this._oItemIcon.bindProperty("src",{path:v,formatter:this._getIconFromMimeType});this.setProperty("mimeType",v)}};
sap.ca.ui.FileUpload.prototype.setFileExtension=function(v){var o=this.getFileExtension();if(o!==v&&!this.getProperty("mimeType")){this._oItemIcon.bindProperty("src",{path:v,formatter:this._getIconFromExtension});this.setProperty("fileExtension",v)}};
sap.ca.ui.FileUpload.prototype._nameChanged=function(e,c){var f=e.getSource().getBindingContext().getProperty();f.newFilename=e.getSource().getValue();this.getModel().setProperty(e.getSource().getBindingContext().getPath()+"/newFilename",f.newFilename);this.getModel().setProperty(e.getSource().getBindingContext().getPath()+"/isPendingFileRename",true);c.fireRenameFile(f)};
sap.ca.ui.FileUpload.prototype._getIconFromExtension=function(v){if(v==="pdf"){return"sap-icon://pdf-attachment"}else if(v==="jpg"||v==="png"||v==="bmp"){return"sap-icon://attachment-photo"}else if(v==="txt"){return"sap-icon://document-text"}else if(v==="doc"||v==="docx"||v==="odt"){return"sap-icon://doc-attachment"}else if(v==="xls"||v==="csv"){return"sap-icon://excel-attachment"}else if(v==="ppt"||v==="pptx"){return"sap-icon://ppt-attachment"}else{return"sap-icon://document"}};
sap.ca.ui.FileUpload.prototype._getIconFromMimeType=function(v){var i="";if(!v){return"sap-icon://document"}if(v.indexOf('image')===0){i="sap-icon://attachment-photo"}else if(v.indexOf('video')===0){i="sap-icon://attachment-video"}else if(v.indexOf('text')===0){i="sap-icon://attachment-text-file"}else if(v.indexOf('audio')===0){i="sap-icon://attachment-audio"}else if(v.indexOf('audio')===0){i="sap-icon://attachment-audio"}else if(v.indexOf('application')===0){switch(v){case'application/vnd.openxmlformats-officedocument.presentationml.presentation':case'application/vnd.ms-powerpoint':case'application/vnd.openxmlformats-officedocument.presentationml.template':i="sap-icon://ppt-attachment";break;case'application/msword':case'application/vnd.openxmlformats-officedocument.wordprocessingml.document':case'application/vnd.openxmlformats-officedocument.wordprocessingml.template':i="sap-icon://doc-attachment";break;case'application/vnd.ms-excel':case'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':case'application/vnd.openxmlformats-officedocument.spreadsheetml.template':i="sap-icon://excel-attachment";break;case'application/pdf':i="sap-icon://pdf-attachment";break;case'application/xhtml+xml':i="sap-icon://attachment-html";break;case'application/zip':case'application/gzip':i="sap-icon://attachment-zip-file";break;default:i="sap-icon://document"}}else{i="sap-icon://document"}return i};
sap.ca.ui.FileUpload.prototype._getAddIcon=function(){var u=sap.ui.core.IconPool.getIconURI("add");this.oAddIcon=sap.ui.core.IconPool.createControlByURI({src:u});this.oAddIcon.addStyleClass("sapCaUiFileUploadGlyphicon");this.oAddIcon.addStyleClass("sapCaUiFileUploadGlyphiconPlus");return this.oAddIcon};
sap.ca.ui.FileUpload.prototype._removeStartingSlash=function(v){if(v&&v.charAt(0)==='/'){return v.substr(1)}return v};
sap.ca.ui.FileUpload.prototype._maintainUploadingProgress=function(){if(this.getModel().getProperty(this.getItems()+"/filesUploaded")>this.getModel().getProperty(this.getItems()+"/filesToUpload")){this.getModel().setProperty(this.getItems()+"/isUploading",false);this.getModel().setProperty(this.getItems()+"/filesToUpload",0);this.getModel().setProperty(this.getItems()+"/filesUploaded",1)}};
sap.ca.ui.FileUpload.prototype._cancelPendingUpload=function(){var i=this.getModel().getProperty(this.getItems());var I=[];jQuery.each(i,jQuery.proxy(function(a,v){if(v&&v.isUploaded){I.push(v)}},this));this.getModel().setProperty(this.getItems(),I);this.getModel().setProperty(this.getItems()+"/filesToUpload",0);this.getModel().setProperty(this.getItems()+"/filesUploaded",i.filesUploaded);this.getModel().setProperty(this.getItems()+"/isUploading",false);this.getModel().setProperty(this.getItems()+"/isEditEnabled",i.isEditEnabled);this.getModel().setProperty(this.getItems()+"/isEditMode",i.isEditMode);this.getModel().setProperty(this.getItems()+"/isUploading",i.isRenameEnabled);this._maintainUploadingProgress()};
sap.ca.ui.FileUpload.prototype._isUploadedChange=function(e,i){var a=e.getSource().getValue();var b=this.getModel().getProperty(i+"/isEditMode");this.getModel().setProperty(e.getSource().getPath().replace("isUploaded","isDeleteVisible"),a&&b)};
sap.ca.ui.FileUpload.prototype._isEditChange=function(e,I){var a=e.getSource().getValue();var b=this.getModel().getProperty(I+"/");for(var i=0;i<b.length;i++){var c=this.getModel().getProperty(I+"/"+i+"/isUploaded");this.getModel().setProperty(I+"/"+i+"/isDeleteVisible",c&&a)}};
sap.ca.ui.FileUpload.prototype._isPhone=function(){return jQuery.device.is.phone};
sap.ca.ui.FileUpload.prototype._isIE=function(){return this._sUsrAg.indexOf("MSIE")>-1};
sap.ca.ui.FileUpload.prototype._setRequestHeaders=function(x){if(this.getAcceptRequestHeader()){x.setRequestHeader("Accept",this.getAcceptRequestHeader())}if(this.getXsrfToken()){x.setRequestHeader('x-csrf-token',this.getXsrfToken())}for(var i=0;i<this._oCustomHeaderArray.length;i++){x.setRequestHeader(this._oCustomHeaderArray[i].key,this._oCustomHeaderArray[i].value)}};
sap.ca.ui.FileUpload.prototype._handleDelete=function(e){var f=e.oSource.getBindingContext().getProperty();sap.ca.ui.dialog.confirmation.open({question:this._sDeleteQuestion,showNote:false,title:this._sDeleteFile,confirmButtonLabel:this._sContinue},jQuery.proxy(function(d){if(d.isConfirmed){this.fireDeleteFile(f)}},this))};
sap.ca.ui.FileUpload.prototype.sending=function(e,d){for(var j=0;j<d.files.length;j++){var D=d.files[j];var s=D.internalId;var n=this.getModel().getProperty(this.getItems()).length;for(var i=0;i<n;i++){var p=this.getItems()+"/"+i;if(this.getModel().getProperty(p)[this.getFileId()]===s&&this.getModel().getProperty(p).isPending){this.getModel().setProperty(p+"/isUploading",true);this.getModel().setProperty(p+"/isPending",false);this.getModel().setProperty(p+"/isUploaded",false)}}}};
sap.ca.ui.FileUpload.prototype.onAdd=function(e,d){for(var j=0;j<d.files.length;j++){var f=d.files[0];var a=Math.random().toString();d.files[0].internalId=a;var I=this.getModel().getProperty(this.getItems());var n={};n[this.getFileId()]=a;n[this.getFileName()]=f.name;n[this.getSize()]=Formatter.format(f.size);n["isPending"]=true;n["isUploading"]=false;n["isUploaded"]=false;n["uploadPercent"]=0;n["isDeleteVisible"]=false;n["isPendingFileRename"]=false;n["isFileNameSwapped"]=false;I.unshift(n);this.getModel().setProperty(this.getItems(),I);var _=d.submit();this.getModel().setProperty(this.getItems()+"/0/abortUpl",_.abort);this.getModel().setProperty(this.getItems()+"/filesToUpload",this.getModel().getProperty(this.getItems()+"/filesToUpload")+1);this.getModel().setProperty(this.getItems()+"/isUploading",true)}var b=this.getModel().getProperty(this.getItems()).length;var c=this.getModel().bindProperty(this.getItems()+"/"+(b-1).toString()+"/isUploaded");c.attachChange(this.getItems(),this._isUploadedChange);var g=this.getModel().getProperty(this.getItems()+"/").length;for(var i=0;i<g;i++){var p=this.getItems()+"/"+i;if(this.getModel().getProperty(p+"/isPendingFileRename")){var t=this.getModel().getProperty(p+"/"+this.getFileName());var N=this.getModel().getProperty(p+"/newFilename");this.getModel().setProperty(p+"/"+this.getFileName(),N);this.getModel().setProperty(p+"/newFilename",t);this.getModel().setProperty(p+"/isFileNameSwapped",true);this.getModel().setProperty(p+"/isPendingFileRename",false)}}};
sap.ca.ui.FileUpload.prototype.calculateProgress=function(e,d){var a=this.getModel().getProperty(this.getItems()).length;for(var i=0;i<a;i++){var p=parseInt(d.loaded/d.total*100,10);var b=this.getItems()+"/"+i;var c=this.getModel().getProperty(b);if(c.isUploading&&c[this.getFileId()]===d.files[0].internalId){this.getModel().setProperty(b+"/uploadPercent",p);this.getModel().setProperty(b+"/isUploaded",false)}}};
sap.ca.ui.FileUpload.prototype.handleUploadFailure=function(e,d){if(d.textStatus!=="abort"){this._cancelPendingUpload();this.fireFileUploadFailed({exception:new Error(this._oBundle.getText("FileUploader.error.connectionLost")),response:d})}};
sap.ca.ui.FileUpload.prototype.uploadDone=function(e,d){try{if(this._isIE()){var E;if(this.getUseMultipart()){E=$('pre',d.result).text();var j=jQuery.parseJSON(E);this.fireUploadFile(j)}else{if(null!==d&&null!==d.result){var f=d.files[0].name;var s=d.files[0];E=$('pre',d.result).text();var J;try{J=jQuery.parseJSON(E)}catch(e){}if(J&&J.error&&J.error.code&&J.error.code==='413'){throw new Error(this._oBundle.getText("FileUploader.error.fileSizeError"))}var m=E.match(/^data\:(.*);base64,/)[1];E=E.replace(/^data\:(.*);base64,/,'');if(null!==E&&""!==E){$.ajax({contentType:m,data:E,type:"POST",url:this.getUploadUrl(),success:jQuery.proxy(function(d,b){var D=d.d?d.d:d;this.fireUploadFile(D)},this),error:function(X,t,b){throw new Error(this._oBundle.getText("FileUploader.error.fileUploadFail")+" "+b)},beforeSend:jQuery.proxy(function(x,d){this.fireBeforeUploadFile(s);this._setRequestHeaders(x);x.setRequestHeader("Content-Transfer-Encoding",'Base64');x.setRequestHeader("Content-Disposition",'attachment; filename="'+f+'"')},this)})}else if(null!==d.result[0]&&null!==d.result[0].title){throw new Error(this._oBundle.getText("FileUploader.error.base64Error")+": "+d.result[0].title)}else{throw new Error(this._oBundle.getText("FileUploader.error.base64Error"))}}}}else if(d&&d.result){this.fireUploadFile(d.result)}else{throw new Error(this._oBundle.getText("FileUploader.error.invalidResponse"))}}catch(a){this._cancelPendingUpload();this.fireFileUploadFailed({exception:a,response:d})}};
